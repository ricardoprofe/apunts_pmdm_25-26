
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Ricardo SÃ¡nchez">
      
      
      
        <link rel="prev" href="../U05.2%20Flutter%20Architecture/">
      
      
        <link rel="next" href="../U05.4%20Mobile%20sensors/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.0">
    
    
      
        <title>Unit 5.3. Geolocation with Flutter - Multimedia and mobile device programming - 2DAM</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.9f615399.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.649f08f9.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Noto Sans";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/my.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="cyan" data-md-color-accent="amber">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#unit-53-geolocation-with-flutter" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Multimedia and mobile device programming - 2DAM" class="md-header__button md-logo" aria-label="Multimedia and mobile device programming - 2DAM" data-md-component="logo">
      
  <img src="../../stylesheets/logo_me_blanc.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Multimedia and mobile device programming - 2DAM
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Unit 5.3. Geolocation with Flutter
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Multimedia and mobile device programming - 2DAM" class="md-nav__button md-logo" aria-label="Multimedia and mobile device programming - 2DAM" data-md-component="logo">
      
  <img src="../../stylesheets/logo_me_blanc.png" alt="logo">

    </a>
    Multimedia and mobile device programming - 2DAM
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multimedia and mobile device programming - 2DAM
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    U01 Introduction to Mobile Development
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            U01 Introduction to Mobile Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U01%20Introduction%20to%20Mobile%20Development/UD1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 01. Introduction to Mobile Development.
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    U02 Android basics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            U02 Android basics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U02%20Android%20basics/U02.1%20-%20Kotlin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 2.1. The Kotlin language
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U02%20Android%20basics/U02.2%20Basic%20Android/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 2.2. Basic Android development
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    U03 Android architecture
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            U03 Android architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U03%20Android%20architecture/U03.1%20Android%20architecture%20copy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 3.1. Android architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U03%20Android%20architecture/U03.2%20The%20MVVM%20pattern/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 3.2 The MVVM design pattern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U03%20Android%20architecture/U03.3%20ViewModel%20guided%20practice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 3.3 ViewModel guided practice
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U03%20Android%20architecture/U03.4%20Navigation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 3.4 Navigation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U03%20Android%20architecture/U03.5%20Navigation%20guided%20practice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 3.5 Navigation guided practice
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    U04 Persistence with Room
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            U04 Persistence with Room
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U04%20Persistence%20with%20Room/U04.1%20Persistence%20with%20Room/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 4.1. Persistence with Room
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U04%20Persistence%20with%20Room/U04.2%20Room%20guided%20practice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 4.2. Room guided practice
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U04%20Persistence%20with%20Room/U04.3%20Relationships/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 4.3. Relationships with Room
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U04%20Persistence%20with%20Room/U04.4%20More/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 4.4. More about Android development
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    U05 Multiplatform development with Flutter
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            U05 Multiplatform development with Flutter
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../U05.1%20Introduction%20to%20Flutter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 5.1. Introduction to Flutter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../U05.2%20Flutter%20Architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 5.2. Flutter Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Unit 5.3. Geolocation with Flutter
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Unit 5.3. Geolocation with Flutter
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#install-the-geolocation-package" class="md-nav__link">
    Install the geolocation package
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-a-single-location" class="md-nav__link">
    Getting a single location
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-continuous-location-updates" class="md-nav__link">
    Getting continuous location updates
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#showing-location-on-a-map" class="md-nav__link">
    Showing location on a map
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../U05.4%20Mobile%20sensors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 5.4. Mobile sensors with Flutter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../U05.5%20Camera/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 5.5. Camera with Flutter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../U05.6%20Files%20storage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 5.6. Files storage with Flutter
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    U06 Connectivity and remote applications
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            U06 Connectivity and remote applications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U06%20Connectivity%20and%20remote%20applications/U06.1%20Introduction%20to%20Firebase%20and%20Firestore/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 6.1 Introduction to Firebase and Firestore
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U06%20Connectivity%20and%20remote%20applications/U06.2%20Using%20Firestore/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 6.2 Using Firestore
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U06%20Connectivity%20and%20remote%20applications/U06.3%20Firebase%20authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 6.3 Using Firebase Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U06%20Connectivity%20and%20remote%20applications/U06.4%20Analytics%20and%20Crashlytics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 6.4 Analytics and Crashlytics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U06%20Connectivity%20and%20remote%20applications/U06.5%20Connectivity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 6.5 Connectivity
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    U07 Introduction to game engines
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            U07 Introduction to game engines
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U07%20Introduction%20to%20game%20engines/U07.1%20Introduction%20to%20Game%20Engines/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 7.1 Introduction to Game Engines
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    U08 Videogames development
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            U08 Videogames development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U08%20Videogames%20development/U08.1%20Introduction%20to%20GDScript/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 8.1 Introduction to GDScript
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U08%20Videogames%20development/U08.2%20Basic%20movement/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 8.2 Basic movement
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U08%20Videogames%20development/U08.3%20Animations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 8.3 Animations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U08%20Videogames%20development/U08.4%20Nodes%20and%20scenes%20instancing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 8.4 Nodes and scenes instancing
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#install-the-geolocation-package" class="md-nav__link">
    Install the geolocation package
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-a-single-location" class="md-nav__link">
    Getting a single location
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-continuous-location-updates" class="md-nav__link">
    Getting continuous location updates
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#showing-location-on-a-map" class="md-nav__link">
    Showing location on a map
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="unit-53-geolocation-with-flutter">Unit 5.3. Geolocation with Flutter</h1>
<h2 id="install-the-geolocation-package">Install the geolocation package</h2>
<p>We will use the <a href="https://pub.dev/packages/geolocator"><code>geolocator</code></a> package to access the device's location services. Add the following dependency to your <code>pubspec.yaml</code> file:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>flutter<span class="w"> </span>pub<span class="w"> </span>add<span class="w"> </span>geolocator
</code></pre></div></td></tr></table></div>
<p>We also need the <code>provider</code> package for state management. If you don't have it yet, add it as well:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>flutter<span class="w"> </span>pub<span class="w"> </span>add<span class="w"> </span>provider
</code></pre></div></td></tr></table></div>
<p>On Android you'll need to add either the <strong><code>ACCESS_COARSE_LOCATION</code></strong> or the <strong><code>ACCESS_FINE_LOCATION</code></strong> permission to your <code>Android Manifest</code>. To do so open the AndroidManifest.xml file (located under <code>android/app/src/main</code>) and add one of the following two lines as direct children of the <code>&lt;manifest&gt;</code> tag (when you configure both permissions the <code>ACCESS_FINE_LOCATION</code> will be used by the geolocator plugin):</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.permission.ACCESS_FINE_LOCATION&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.permission.ACCESS_COARSE_LOCATION&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</code></pre></div></td></tr></table></div>
<div class="admonition info">
<p class="admonition-title">FINE and COARSE location</p>
<p>The <strong><code>ACCESS_FINE_LOCATION</code></strong> permission provides a more accurate location using GPS, while the <strong><code>ACCESS_COARSE_LOCATION</code></strong> permission provides a less accurate location using Wi-Fi and cell towers. Choose the permission that best fits your app's needs.</p>
</div>
<p>On <strong>iOS</strong> you'll need to add the following entry to your Info.plist file (located under <code>ios/Runner</code>) in order to access the device's location. Simply open your Info.plist file and add the following (make sure you update the description so it is meaningful in the context of your App):</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">&lt;key&gt;</span>NSLocationWhenInUseUsageDescription<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;string&gt;</span>This<span class="w"> </span>app<span class="w"> </span>needs<span class="w"> </span>access<span class="w"> </span>to<span class="w"> </span>location<span class="w"> </span>when<span class="w"> </span>open.<span class="nt">&lt;/string&gt;</span>
</code></pre></div></td></tr></table></div>
<h2 id="getting-a-single-location">Getting a single location</h2>
<p>Before start coding, we are going to do the next app files:</p>
<ul>
<li><strong><code>main.dart</code></strong>: the entry point of the app.</li>
<li><strong><code>my_app.dart</code></strong>: the main widget of the app.</li>
<li><strong><code>location_screen.dart</code></strong>: the screen that shows the location.</li>
<li><strong><code>location_provider.dart</code></strong>: the provider that handles the location logic.</li>
</ul>
<p>In <code>my_app.dart</code>, we will set up the MaterialApp and the ChangeNotifierProvider for listening to location changes from the LocationProvider.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// my_app.dart</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:provider/provider.dart&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="s1">&#39;location_screen.dart&#39;</span><span class="p">;</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">MyApp</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">StatelessWidget</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">MyApp</span><span class="p">({</span><span class="k">super</span><span class="p">.</span><span class="n">key</span><span class="p">});</span>

<span class="w">  </span><span class="nd">@override</span>
<span class="w">  </span><span class="n">Widget</span><span class="w"> </span><span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ChangeNotifierProvider</span><span class="p">(</span>
<span class="w">      </span><span class="nl">create:</span><span class="w"> </span><span class="p">(</span><span class="n">BuildContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">LocationProvider</span><span class="p">(),</span>
<span class="w">      </span><span class="nl">child:</span><span class="w"> </span><span class="n">MaterialApp</span><span class="p">(</span>
<span class="w">        </span><span class="nl">title:</span><span class="w"> </span><span class="s1">&#39;Geolocation App&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nl">theme:</span><span class="w"> </span><span class="n">ThemeData</span><span class="p">(</span>
<span class="w">          </span><span class="nl">colorScheme:</span><span class="w"> </span><span class="n">ColorScheme</span><span class="p">.</span><span class="n">fromSeed</span><span class="p">(</span><span class="nl">seedColor:</span><span class="w"> </span><span class="n">Colors</span><span class="p">.</span><span class="n">lightBlue</span><span class="p">),</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="nl">debugShowCheckedModeBanner:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nl">home:</span><span class="w"> </span><span class="n">LocationScreen</span><span class="p">()</span><span class="w"> </span><span class="p">,</span>
<span class="w">      </span><span class="p">),</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>In the location_provider.dart file, we will implement the logic to get the current location using the Geolocator package. First, we create a property to hold the current position, <code>currentPosition</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// location_provider.dart</span>

<span class="k">import</span><span class="w"> </span><span class="s1">&#39;dart:async&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:flutter/material.dart&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:geolocator/geolocator.dart&#39;</span><span class="p">;</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">LocationProvider</span><span class="w"> </span><span class="kd">with</span><span class="w"> </span><span class="n">ChangeNotifier</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">Position</span><span class="o">?</span><span class="w"> </span><span class="n">_currentPosition</span><span class="p">;</span>
<span class="w">  </span><span class="n">Position</span><span class="o">?</span><span class="w"> </span><span class="kd">get</span><span class="w"> </span><span class="n">currentPosition</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">_currentPosition</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Following the <a href="https://pub.dev/packages/geolocator">Geolocator package documentation</a>, we will implement a private method to check and request location permissions, <code>checkPermission()</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// location_provider.dart</span>

<span class="n">Future</span><span class="o">&lt;</span><span class="n">Position</span><span class="o">&gt;</span><span class="w"> </span><span class="n">_determinePosition</span><span class="p">()</span><span class="w"> </span><span class="kd">async</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Check if location services are enabled</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">serviceEnabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">await</span><span class="w"> </span><span class="n">Geolocator</span><span class="p">.</span><span class="n">isLocationServiceEnabled</span><span class="p">();</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">serviceEnabled</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Location services are not enabled return an error message</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Future</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Location services are disabled.&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Check location permissions</span>
<span class="w">  </span><span class="n">LocationPermission</span><span class="w"> </span><span class="n">permission</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">await</span><span class="w"> </span><span class="n">Geolocator</span><span class="p">.</span><span class="n">checkPermission</span><span class="p">();</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">permission</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">LocationPermission</span><span class="p">.</span><span class="n">denied</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">permission</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">await</span><span class="w"> </span><span class="n">Geolocator</span><span class="p">.</span><span class="n">requestPermission</span><span class="p">();</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">permission</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">LocationPermission</span><span class="p">.</span><span class="n">denied</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">Future</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Location permissions are denied&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">permission</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">LocationPermission</span><span class="p">.</span><span class="n">deniedForever</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Future</span><span class="p">.</span><span class="n">error</span><span class="p">(</span>
<span class="w">      </span><span class="s1">&#39;Location permissions are permanently denied, we cannot request permissions.&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// If permissions are granted, return the current location</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="kd">await</span><span class="w"> </span><span class="n">Geolocator</span><span class="p">.</span><span class="n">getCurrentPosition</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Now, we will implement the <code>fetchCurrentLocation()</code>, inside the LocationProvider class, that will use <code>_determinePosition()</code> to get the current location and update the <code>currentPosition</code> property:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// location_provider.dart</span>

<span class="n">Future</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fetchCurrentLocation</span><span class="p">()</span><span class="w"> </span><span class="kd">async</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">_currentPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">await</span><span class="w"> </span><span class="n">_determinePosition</span><span class="p">();</span>
<span class="w">        </span><span class="n">notifyListeners</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Handle location errors here if necessary</span>
<span class="w">        </span><span class="n">print</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>This method will be called from the UI to fetch the current location when needed. Note how we call <code>notifyListeners()</code> to inform any listeners that the location has been updated.</p>
<p>Finally, in the <code>location_screen.dart</code> file, we will create a simple UI to display the current location and a button to fetch it:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// location_screen.dart</span>

<span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:flutter/material.dart&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:provider/provider.dart&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="s1">&#39;location_provider.dart&#39;</span><span class="p">;</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">LocationScreen</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">StatefulWidget</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">LocationScreen</span><span class="p">({</span><span class="k">super</span><span class="p">.</span><span class="n">key</span><span class="p">});</span>

<span class="w">  </span><span class="nd">@override</span>
<span class="w">  </span><span class="n">State</span><span class="o">&lt;</span><span class="n">LocationScreen</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createState</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">_LocationScreenState</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">_LocationScreenState</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">State</span><span class="o">&lt;</span><span class="n">LocationScreen</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>


<span class="w">  </span><span class="n">Future</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span><span class="w"> </span><span class="n">_fetchCurrentLocation</span><span class="p">()</span><span class="w"> </span><span class="kd">async</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Provider</span><span class="p">.</span><span class="n">of</span><span class="o">&lt;</span><span class="n">LocationProvider</span><span class="o">&gt;</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="nl">listen:</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<span class="w">    </span><span class="kd">await</span><span class="w"> </span><span class="n">provider</span><span class="p">.</span><span class="n">fetchCurrentLocation</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nd">@override</span>
<span class="w">  </span><span class="n">Widget</span><span class="w"> </span><span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">locationProvider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Provider</span><span class="p">.</span><span class="n">of</span><span class="o">&lt;</span><span class="n">LocationProvider</span><span class="o">&gt;</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="nl">listen:</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">locationProvider</span><span class="p">.</span><span class="n">currentPosition</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Scaffold</span><span class="p">(</span>
<span class="w">      </span><span class="nl">appBar:</span><span class="w"> </span><span class="n">AppBar</span><span class="p">(</span>
<span class="w">        </span><span class="nl">title:</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Live Location&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="nl">centerTitle:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nl">backgroundColor:</span><span class="w"> </span><span class="n">Theme</span><span class="p">.</span><span class="n">of</span><span class="p">(</span><span class="n">context</span><span class="p">).</span><span class="n">colorScheme</span><span class="p">.</span><span class="n">primary</span><span class="p">,</span>
<span class="w">      </span><span class="p">),</span>
<span class="w">      </span><span class="nl">body:</span><span class="w"> </span><span class="n">Center</span><span class="p">(</span>
<span class="w">        </span><span class="nl">child:</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">            </span><span class="o">?</span><span class="w"> </span><span class="n">Column</span><span class="p">(</span>
<span class="w">                </span><span class="nl">mainAxisSize:</span><span class="w"> </span><span class="n">MainAxisSize</span><span class="p">.</span><span class="n">min</span><span class="p">,</span>
<span class="w">                </span><span class="nl">children:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                  </span><span class="k">const</span><span class="w"> </span><span class="n">SizedBox</span><span class="p">(</span><span class="nl">height:</span><span class="w"> </span><span class="m">16</span><span class="p">),</span>

<span class="w">                  </span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Latitude: </span><span class="si">${</span><span class="n">pos</span><span class="p">.</span><span class="n">latitude</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span>
<span class="w">                  </span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Longitude: </span><span class="si">${</span><span class="n">pos</span><span class="p">.</span><span class="n">longitude</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span>
<span class="w">                  </span><span class="k">const</span><span class="w"> </span><span class="n">SizedBox</span><span class="p">(</span><span class="nl">height:</span><span class="w"> </span><span class="m">8</span><span class="p">),</span>
<span class="w">                  </span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Accuracy: </span><span class="si">${</span><span class="n">pos</span><span class="p">.</span><span class="n">accuracy</span><span class="si">}</span><span class="s1"> m&#39;</span><span class="p">),</span>
<span class="w">                  </span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Timestamp: </span><span class="si">${</span><span class="n">pos</span><span class="p">.</span><span class="n">timestamp</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span>
<span class="w">                </span><span class="p">],</span>
<span class="w">              </span><span class="p">)</span>
<span class="w">            </span><span class="o">:</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;No location yet. Tap &quot;Get location&quot; to get it.&#39;</span><span class="p">),</span>
<span class="w">      </span><span class="p">),</span>
<span class="w">      </span><span class="nl">floatingActionButton:</span><span class="w"> </span><span class="n">FloatingActionButton</span><span class="p">.</span><span class="n">extended</span><span class="p">(</span>
<span class="w">        </span><span class="nl">onPressed:</span><span class="w"> </span><span class="n">_fetchCurrentLocation</span><span class="p">,</span>
<span class="w">        </span><span class="nl">label:</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Get location&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="nl">icon:</span><span class="w"> </span><span class="n">Icon</span><span class="p">(</span><span class="n">Icons</span><span class="p">.</span><span class="n">map</span><span class="p">),</span>
<span class="w">      </span><span class="p">),</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Here we are using a StatefulWidget to manage the state of the location fetching process. The <code>_fetchCurrentLocation()</code> method calls the <code>fetchCurrentLocation()</code> method from the LocationProvider when the button is pressed. The UI displays the current latitude, longitude, accuracy, and timestamp if a location is available; otherwise, it prompts the user to get the location.</p>
<div class="admonition info">
<p class="admonition-title">Futures</p>
<p>A <code>Future</code> in Dart represents a potential value or error that will be available at some time in the future. It is used for asynchronous programming, allowing you to perform tasks that may take time (like fetching data from the internet or accessing device features) without blocking the main thread of execution.<br />
More info about Futures <a href="https://dart.dev/codelabs/async-await">here</a>.</p>
</div>
<p>The first time we launch the app, it will ask for location permissions.</p>
<p><img alt="Permission Request Screenshot" src="../images/permissions01.png" /></p>
<p>Once running, the app will look like this:</p>
<p><img alt="Geolocation App Screenshot" src="../images/location01.png" /></p>
<p>If we are using the Android Studio emulator, we can simulate location changes by going to the <em>"Extended controls" (three dots icon) &gt; "Location"</em> and entering new latitude and longitude values.</p>
<p><img alt="Extended Controls Screenshot" src="../images/extended_controls.png" /></p>
<h2 id="getting-continuous-location-updates">Getting continuous location updates</h2>
<p>To get continuous location updates, we will modify the <code>LocationProvider</code> to include a stream subscription that listens for location changes. We will use the <code>getPositionStream()</code> method from the Geolocator package.</p>
<p>First, we need to add a <code>StreamSubscription&lt;Position&gt;</code> property to the <code>LocationProvider</code> class to manage the subscription:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// location_provider.dart</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">LocationProvider</span><span class="w"> </span><span class="kd">with</span><span class="w"> </span><span class="n">ChangeNotifier</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">Position</span><span class="o">?</span><span class="w"> </span><span class="n">_currentPosition</span><span class="p">;</span>
<span class="w">  </span><span class="n">Position</span><span class="o">?</span><span class="w"> </span><span class="kd">get</span><span class="w"> </span><span class="n">currentPosition</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">_currentPosition</span><span class="p">;</span>

<span class="w">  </span><span class="n">StreamSubscription</span><span class="o">&lt;</span><span class="n">Position</span><span class="o">&gt;?</span><span class="w"> </span><span class="n">_positionStream</span><span class="p">;</span><span class="w"> </span><span class="c1">//ADD THIS</span>
<span class="p">}</span>
<span class="p">...</span>
</code></pre></div></td></tr></table></div>
<p>The core of the continuous location updates will be handled by a new method called <code>startListening()</code>. This method will set up the stream subscription to listen for location updates:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// location_provider.dart</span>

<span class="c1">/// Start listening to location updates. This will request permissions if needed</span>
<span class="c1">/// (by calling determinePosition) and then subscribe to the position stream.</span>
<span class="n">Future</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span><span class="w"> </span><span class="n">startListening</span><span class="p">({</span><span class="n">LocationSettings</span><span class="o">?</span><span class="w"> </span><span class="n">locationSettings</span><span class="p">})</span><span class="w"> </span><span class="kd">async</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Try to read a cached last-known position first to give callers</span>
<span class="w">  </span><span class="c1">// a quick value while we request permissions or fetch a fresh position.</span>
<span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">lastKnown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">await</span><span class="w"> </span><span class="n">Geolocator</span><span class="p">.</span><span class="n">getLastKnownPosition</span><span class="p">();</span><span class="w"> </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lastKnown</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">_currentPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lastKnown</span><span class="p">;</span>
<span class="w">      </span><span class="n">notifyListeners</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Non-fatal: continue to request a fresh position below.</span>
<span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;startListening: getLastKnownPosition failed: </span><span class="si">$</span><span class="n">e</span><span class="s1">&#39;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Ensure permissions and services are available before starting the stream</span>
<span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Capture and store the initial/current position so callers have a value</span>
<span class="w">    </span><span class="c1">// available immediately after startListening completes.</span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">initialPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">await</span><span class="w"> </span><span class="n">_determinePosition</span><span class="p">();</span>
<span class="w">    </span><span class="n">_currentPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">initialPosition</span><span class="p">;</span>
<span class="w">    </span><span class="n">notifyListeners</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// If we couldn&#39;t obtain a single position (permissions/service disabled),</span>
<span class="w">    </span><span class="c1">// do not start the stream. Caller can inspect logs or call fetchCurrentLocation.</span>
<span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;startListening: could not determine position first: </span><span class="si">$</span><span class="n">e</span><span class="s1">&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Avoid double subscription (Singleton pattern)</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_positionStream</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// Use provided settings or default ones</span>
<span class="w">  </span><span class="kd">final</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="o">=</span>
<span class="w">      </span><span class="n">locationSettings</span><span class="w"> </span><span class="o">??</span>
<span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="n">LocationSettings</span><span class="p">(</span>
<span class="w">        </span><span class="nl">accuracy:</span><span class="w"> </span><span class="n">LocationAccuracy</span><span class="p">.</span><span class="n">best</span><span class="p">,</span>
<span class="w">        </span><span class="nl">distanceFilter:</span><span class="w"> </span><span class="m">10</span><span class="p">,</span>
<span class="w">      </span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Subscribe to the position stream</span>
<span class="w">  </span><span class="n">_positionStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Geolocator</span><span class="p">.</span><span class="n">getPositionStream</span><span class="p">(</span><span class="nl">locationSettings:</span><span class="w"> </span><span class="n">settings</span><span class="p">)</span>
<span class="w">      </span><span class="p">.</span><span class="n">listen</span><span class="p">(</span>
<span class="w">        </span><span class="p">(</span><span class="n">Position</span><span class="w"> </span><span class="n">position</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">_currentPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<span class="w">          </span><span class="n">notifyListeners</span><span class="p">();</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nl">onError:</span><span class="w"> </span><span class="p">(</span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Position stream error: </span><span class="si">$</span><span class="n">error</span><span class="s1">&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">      </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>In this function, we first try to get the last known position to provide a quick initial value: <code>Geolocator.getLastKnownPosition()</code>.</p>
<p>Then, we ensure that location services and permissions are available by calling <code>_determinePosition()</code>. If successful, we set up the stream subscription using <code>Geolocator.getPositionStream()</code> with the provided or default location settings.</p>
<p>To stop listening to location updates, we will implement a <code>stopListening()</code> method that cancels the stream subscription:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// location_provider.dart</span>

<span class="n">Future</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stopListening</span><span class="p">()</span><span class="w"> </span><span class="kd">async</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">await</span><span class="w"> </span><span class="n">_positionStream</span><span class="o">?</span><span class="p">.</span><span class="n">cancel</span><span class="p">();</span>
<span class="w">  </span><span class="n">_positionStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Also, we need to ensure that we clean up the subscription when the <code>LocationProvider</code> is disposed of. We can override the <code>dispose()</code> method of the provider to call <code>stopListening()</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// location_provider.dart</span>

<span class="c1">/// Clean up resources when the provider is disposed.</span>
<span class="nd">@override</span>
<span class="kt">void</span><span class="w"> </span><span class="n">dispose</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">stopListening</span><span class="p">();</span>
<span class="w">  </span><span class="k">super</span><span class="p">.</span><span class="n">dispose</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>With these changes, the <code>LocationProvider</code> can now provide continuous location updates to any listeners. You can call <code>startListening()</code> to begin receiving updates and <code>stopListening()</code> to stop them when they are no longer needed.</p>
<p>The next step is to update the <code>LocationScreen</code> to start and stop listening for location updates when the screen is initialized and disposed of, respectively.</p>
<p>Create a new StatefulWidget called <code>ContinuousLocationScreen</code> (you can duplicate the existing <code>LocationScreen</code>) and assign it to the home property in <code>my_app.dart</code>. The new screen is similar to the previous one but includes calls to <code>startListening()</code> and <code>stopListening()</code> in the appropriate lifecycle methods:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// continuous_location_screen.dart</span>

<span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:flutter/material.dart&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:provider/provider.dart&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="s1">&#39;location_provider.dart&#39;</span><span class="p">;</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">ContinuousLocationScreen</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">StatefulWidget</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">ContinuousLocationScreen</span><span class="p">({</span><span class="k">super</span><span class="p">.</span><span class="n">key</span><span class="p">});</span>

<span class="w">  </span><span class="nd">@override</span>
<span class="w">  </span><span class="n">State</span><span class="o">&lt;</span><span class="n">ContinuousLocationScreen</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createState</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">_ContinuousLocationScreenState</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">_ContinuousLocationScreenState</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">State</span><span class="o">&lt;</span><span class="n">ContinuousLocationScreen</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="nd">@override</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">initState</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">super</span><span class="p">.</span><span class="n">initState</span><span class="p">();</span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Provider</span><span class="p">.</span><span class="n">of</span><span class="o">&lt;</span><span class="n">LocationProvider</span><span class="o">&gt;</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="nl">listen:</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<span class="w">    </span><span class="n">provider</span><span class="p">.</span><span class="n">startListening</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nd">@override</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">dispose</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Provider</span><span class="p">.</span><span class="n">of</span><span class="o">&lt;</span><span class="n">LocationProvider</span><span class="o">&gt;</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="nl">listen:</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<span class="w">    </span><span class="n">provider</span><span class="p">.</span><span class="n">stopListening</span><span class="p">();</span>
<span class="w">    </span><span class="k">super</span><span class="p">.</span><span class="n">dispose</span><span class="p">();</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="nd">@override</span>
<span class="w">  </span><span class="n">Widget</span><span class="w"> </span><span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">locationProvider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Provider</span><span class="p">.</span><span class="n">of</span><span class="o">&lt;</span><span class="n">LocationProvider</span><span class="o">&gt;</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="nl">listen:</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">locationProvider</span><span class="p">.</span><span class="n">currentPosition</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Scaffold</span><span class="p">(</span>
<span class="w">      </span><span class="nl">appBar:</span><span class="w"> </span><span class="n">AppBar</span><span class="p">(</span>
<span class="w">        </span><span class="nl">title:</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Live Location&#39;</span><span class="p">),</span>
<span class="w">        </span><span class="nl">centerTitle:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nl">backgroundColor:</span><span class="w"> </span><span class="n">Theme</span><span class="p">.</span><span class="n">of</span><span class="p">(</span><span class="n">context</span><span class="p">).</span><span class="n">colorScheme</span><span class="p">.</span><span class="n">primary</span><span class="p">,</span>
<span class="w">      </span><span class="p">),</span>
<span class="w">      </span><span class="nl">body:</span><span class="w"> </span><span class="n">Center</span><span class="p">(</span>
<span class="w">        </span><span class="nl">child:</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">            </span><span class="o">?</span><span class="w"> </span><span class="n">Column</span><span class="p">(</span>
<span class="w">                </span><span class="nl">mainAxisSize:</span><span class="w"> </span><span class="n">MainAxisSize</span><span class="p">.</span><span class="n">min</span><span class="p">,</span>
<span class="w">                </span><span class="nl">children:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                  </span><span class="k">const</span><span class="w"> </span><span class="n">SizedBox</span><span class="p">(</span><span class="nl">height:</span><span class="w"> </span><span class="m">16</span><span class="p">),</span>

<span class="w">                  </span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Latitude: </span><span class="si">${</span><span class="n">pos</span><span class="p">.</span><span class="n">latitude</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span>
<span class="w">                  </span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Longitude: </span><span class="si">${</span><span class="n">pos</span><span class="p">.</span><span class="n">longitude</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span>
<span class="w">                  </span><span class="k">const</span><span class="w"> </span><span class="n">SizedBox</span><span class="p">(</span><span class="nl">height:</span><span class="w"> </span><span class="m">8</span><span class="p">),</span>
<span class="w">                  </span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Accuracy: </span><span class="si">${</span><span class="n">pos</span><span class="p">.</span><span class="n">accuracy</span><span class="si">}</span><span class="s1"> m&#39;</span><span class="p">),</span>
<span class="w">                  </span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Timestamp: </span><span class="si">${</span><span class="n">pos</span><span class="p">.</span><span class="n">timestamp</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span>
<span class="w">                </span><span class="p">],</span>
<span class="w">              </span><span class="p">)</span>
<span class="w">            </span><span class="o">:</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;No location yet. Wait a moment.&#39;</span><span class="p">),</span>
<span class="w">      </span><span class="p">)</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="admonition question">
<p class="admonition-title">Task</p>
<p>Modify the <code>ContinuousLocationScreen</code> to include a button that allows the user to manually start and stop location updates. The button should toggle between "Start Listening" and "Stop Listening" based on the current state of the location updates.</p>
</div>
<h2 id="showing-location-on-a-map">Showing location on a map</h2>
<p>To display the user's location on a map, we are going to use the next packages:</p>
<ul>
<li><a href="https://pub.dev/packages/flutter_map">flutter_map</a>: that provides a customizable map widget based on OpenStreetMap.</li>
<li><a href="https://pub.dev/packages/latlong2">latlong2</a>: that provides latitude and longitude data types.</li>
</ul>
<p>Import them using the following commands:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>flutter<span class="w"> </span>pub<span class="w"> </span>add<span class="w"> </span>flutter_map
flutter<span class="w"> </span>pub<span class="w"> </span>add<span class="w"> </span>latlong2
</code></pre></div></td></tr></table></div>
<p>The <code>pubspec.yaml</code> file should now include these dependencies:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># pubspec.yaml</span>

<span class="nt">dependencies</span><span class="p">:</span>
<span class="w">  </span><span class="nt">flutter</span><span class="p">:</span>
<span class="w">    </span><span class="nt">sdk</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flutter</span>
<span class="w">  </span><span class="nt">geolocator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^14.0.2</span>
<span class="w">  </span><span class="nt">provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^6.1.5+1</span>
<span class="w">  </span><span class="nt">flutter_map</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^8.2.2</span>
<span class="w">  </span><span class="nt">latlong2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^0.9.1</span>
</code></pre></div></td></tr></table></div>
<p>We are goig to create a new screen called <code>MapScreen</code> that will display the user's location on a map. Create a new file named <code>map_screen.dart</code> and create a new StatefulWidget called <code>MapScreen</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// map_screen.dart</span>

<span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:flutter/material.dart&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:flutter_map/flutter_map.dart&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:latlong2/latlong.dart&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="s1">&#39;package:provider/provider.dart&#39;</span><span class="p">;</span>

<span class="k">import</span><span class="w"> </span><span class="s1">&#39;location_provider.dart&#39;</span><span class="p">;</span>


<span class="kd">class</span><span class="w"> </span><span class="nc">MapScreen</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">StatefulWidget</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">MapScreen</span><span class="p">({</span><span class="k">super</span><span class="p">.</span><span class="n">key</span><span class="p">});</span>

<span class="w">  </span><span class="nd">@override</span>
<span class="w">  </span><span class="n">State</span><span class="o">&lt;</span><span class="n">MapScreen</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createState</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">_MapScreenState</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">_MapScreenState</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">State</span><span class="o">&lt;</span><span class="n">MapScreen</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">late</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">MapController</span><span class="w"> </span><span class="n">_mapController</span><span class="p">;</span>
<span class="w">  </span><span class="kd">final</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">_initialZoom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">14.0</span><span class="p">;</span><span class="w"> </span><span class="c1">// The bigger the value, the closer the zoom</span>
<span class="p">...</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Here we have defined a <code>MapController</code> to control the map and an initial zoom level.</p>
<p>In the <strong><code>MyApp</code></strong> class, update the home property to use the <code>MapScreen</code> instead of the previous location screen:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// my_app.dart</span>

<span class="nl">home:</span><span class="w"> </span><span class="n">MapScreen</span><span class="p">(),</span>
</code></pre></div></td></tr></table></div>
<p>Next, create the <code>initState()</code> method to initialize the <code>MapController</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// map_screen.dart</span>

<span class="nd">@override</span>
<span class="kt">void</span><span class="w"> </span><span class="n">initState</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">super</span><span class="p">.</span><span class="n">initState</span><span class="p">();</span>

<span class="w">  </span><span class="n">WidgetsBinding</span><span class="p">.</span><span class="n">instance</span><span class="p">.</span><span class="n">addPostFrameCallback</span><span class="p">((</span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="kd">async</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Fetch location after the first frame</span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Provider</span><span class="p">.</span><span class="n">of</span><span class="o">&lt;</span><span class="n">LocationProvider</span><span class="o">&gt;</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="nl">listen:</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<span class="w">    </span><span class="kd">await</span><span class="w"> </span><span class="n">provider</span><span class="p">.</span><span class="n">fetchCurrentLocation</span><span class="p">();</span>
<span class="w">  </span><span class="p">});</span>
<span class="w">  </span><span class="n">_mapController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MapController</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>In this method, we also fetch the current location after the first frame is rendered (<code>WidgetsBinding.instance.addPostFrameCallback</code>) to ensure that we have a location to display on the map.</p>
<p>Also, override the <code>dispose()</code> method to clean up resources:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// map_screen.dart</span>

<span class="nd">@override</span>
<span class="kt">void</span><span class="w"> </span><span class="n">dispose</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">_mapController</span><span class="p">.</span><span class="n">dispose</span><span class="p">();</span>
<span class="w">  </span><span class="k">super</span><span class="p">.</span><span class="n">dispose</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>In this screen we want to fetch a location when the favorite button is pressed. So, we will create a method called <code>_fetchCurrentLocation()</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// map_screen.dart</span>

<span class="n">Future</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span><span class="w"> </span><span class="n">_fetchCurrentLocation</span><span class="p">()</span><span class="w"> </span><span class="kd">async</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">final</span><span class="w"> </span><span class="n">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Provider</span><span class="p">.</span><span class="n">of</span><span class="o">&lt;</span><span class="n">LocationProvider</span><span class="o">&gt;</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="nl">listen:</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<span class="w">  </span><span class="kd">await</span><span class="w"> </span><span class="n">provider</span><span class="p">.</span><span class="n">fetchCurrentLocation</span><span class="p">();</span>
<span class="w">  </span><span class="kd">final</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">provider</span><span class="p">.</span><span class="n">currentPosition</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pos</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">_mapController</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">LatLng</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">latitude</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">.</span><span class="n">longitude</span><span class="p">),</span><span class="w"> </span><span class="n">_initialZoom</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>This method fetches asynchronously the current location using the <code>LocationProvider</code> and moves the map to that location if it is available.</p>
<p>In the <code>build</code> method, we will create the UI for the map screen: a <strong>Scaffold</strong> with an <strong>AppBar</strong>, a <strong>FlutterMap</strong> widget to display the map, and a <strong>FloatingActionButton</strong> to fetch the current location. We also add a <strong>Text</strong> widget in top-center to show the current latitude and longitude.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@override</span>
<span class="n">Widget</span><span class="w"> </span><span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="n">locationService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Provider</span><span class="p">.</span><span class="n">of</span><span class="o">&lt;</span><span class="n">LocationProvider</span><span class="o">&gt;</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="nl">listen:</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<span class="w">  </span><span class="kd">final</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">locationService</span><span class="p">.</span><span class="n">currentPosition</span><span class="p">;</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">Scaffold</span><span class="p">(</span>
<span class="w">    </span><span class="nl">appBar:</span><span class="w"> </span><span class="n">AppBar</span><span class="p">(</span>
<span class="w">      </span><span class="nl">title:</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Map Location&#39;</span><span class="p">),</span>
<span class="w">      </span><span class="nl">centerTitle:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">      </span><span class="nl">backgroundColor:</span><span class="w"> </span><span class="n">Theme</span><span class="p">.</span><span class="n">of</span><span class="p">(</span><span class="n">context</span><span class="p">).</span><span class="n">colorScheme</span><span class="p">.</span><span class="n">primary</span><span class="p">,</span>
<span class="w">    </span><span class="p">),</span>
<span class="w">    </span><span class="nl">floatingActionButton:</span><span class="w"> </span><span class="n">FloatingActionButton</span><span class="p">.</span><span class="n">extended</span><span class="p">(</span>
<span class="w">      </span><span class="nl">onPressed:</span><span class="w"> </span><span class="n">_fetchCurrentLocation</span><span class="p">,</span>
<span class="w">      </span><span class="nl">label:</span><span class="w"> </span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Get location&#39;</span><span class="p">),</span>
<span class="w">      </span><span class="nl">icon:</span><span class="w"> </span><span class="n">Icon</span><span class="p">(</span><span class="n">Icons</span><span class="p">.</span><span class="n">map</span><span class="p">),</span>
<span class="w">    </span><span class="p">),</span>
<span class="w">    </span><span class="c1">// The main widget that renders the map</span>
<span class="w">    </span><span class="nl">body:</span><span class="w"> </span><span class="n">Column</span><span class="p">(</span>
<span class="w">      </span><span class="nl">children:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="n">Text</span><span class="p">(</span>
<span class="w">          </span><span class="n">pos</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">              </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;Latitude: </span><span class="si">${</span><span class="n">pos</span><span class="p">.</span><span class="n">latitude</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">Longitude: </span><span class="si">${</span><span class="n">pos</span><span class="p">.</span><span class="n">longitude</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="w">              </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;No location yet.&#39;</span><span class="p">,</span>
<span class="w">          </span><span class="nl">style:</span><span class="w"> </span><span class="n">TextStyle</span><span class="p">(</span><span class="nl">fontSize:</span><span class="w"> </span><span class="m">16</span><span class="p">),</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="n">Expanded</span><span class="p">(</span>
<span class="w">          </span><span class="nl">child:</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">              </span><span class="o">?</span><span class="w"> </span><span class="n">FlutterMap</span><span class="p">(</span>
<span class="w">                  </span><span class="nl">mapController:</span><span class="w"> </span><span class="n">_mapController</span><span class="p">,</span>
<span class="w">                  </span><span class="c1">// Map options, such as initial center and zoom</span>
<span class="w">                  </span><span class="nl">options:</span><span class="w"> </span><span class="n">MapOptions</span><span class="p">(</span>
<span class="w">                    </span><span class="nl">initialCenter:</span><span class="w"> </span><span class="n">LatLng</span><span class="p">(</span>
<span class="w">                      </span><span class="n">pos</span><span class="o">!</span><span class="p">.</span><span class="n">latitude</span><span class="p">,</span>
<span class="w">                      </span><span class="n">pos</span><span class="p">.</span><span class="n">longitude</span><span class="p">,</span>
<span class="w">                    </span><span class="p">),</span><span class="w"> </span><span class="c1">// Centered on user&#39;s location</span>
<span class="w">                    </span><span class="nl">initialZoom:</span><span class="w"> </span><span class="n">_initialZoom</span><span class="p">,</span>
<span class="w">                  </span><span class="p">),</span>
<span class="w">                  </span><span class="c1">// The map is built in layers</span>
<span class="w">                  </span><span class="nl">children:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                    </span><span class="c1">// Layer 1: The base map from OpenStreetMap</span>
<span class="w">                    </span><span class="n">TileLayer</span><span class="p">(</span>
<span class="w">                      </span><span class="nl">urlTemplate:</span>
<span class="w">                          </span><span class="s1">&#39;https://tile.openstreetmap.org/{z}/{x}/{y}.png&#39;</span><span class="p">,</span>
<span class="w">                      </span><span class="nl">userAgentPackageName:</span><span class="w"> </span><span class="s1">&#39;com.example.flutter_map_example&#39;</span><span class="p">,</span>
<span class="w">                    </span><span class="p">),</span>
<span class="w">                    </span><span class="c1">// Layer 2: Our pins (markers)</span>
<span class="w">                    </span><span class="n">MarkerLayer</span><span class="p">(</span>
<span class="w">                      </span><span class="nl">markers:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                        </span><span class="n">Marker</span><span class="p">(</span>
<span class="w">                          </span><span class="nl">point:</span><span class="w"> </span><span class="n">LatLng</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">latitude</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="p">.</span><span class="n">longitude</span><span class="p">),</span>
<span class="w">                          </span><span class="nl">child:</span><span class="w"> </span><span class="n">Icon</span><span class="p">(</span>
<span class="w">                            </span><span class="n">Icons</span><span class="p">.</span><span class="n">location_pin</span><span class="p">,</span>
<span class="w">                            </span><span class="nl">color:</span><span class="w"> </span><span class="n">Colors</span><span class="p">.</span><span class="n">red</span><span class="p">,</span>
<span class="w">                            </span><span class="nl">size:</span><span class="w"> </span><span class="m">40</span><span class="p">,</span>
<span class="w">                          </span><span class="p">),</span>
<span class="w">                        </span><span class="p">),</span>
<span class="w">                      </span><span class="p">],</span>
<span class="w">                    </span><span class="p">),</span>
<span class="w">                  </span><span class="p">],</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">              </span><span class="o">:</span><span class="w"> </span><span class="n">Center</span><span class="p">(</span>
<span class="w">                  </span><span class="nl">child:</span><span class="w"> </span><span class="n">Column</span><span class="p">(</span>
<span class="w">                    </span><span class="nl">children:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                      </span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;No location yet.&#39;</span><span class="p">),</span>
<span class="w">                      </span><span class="n">CircularProgressIndicator</span><span class="p">(),</span><span class="w"> </span><span class="c1">//Shows a loading indicator while waiting for location</span>
<span class="w">                    </span><span class="p">],</span>
<span class="w">                  </span><span class="p">),</span>
<span class="w">                </span><span class="p">),</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">    </span><span class="p">),</span>
<span class="w">  </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>The widget that renders the map is <code>FlutterMap</code>, which takes a <code>MapOptions</code> object to configure the initial center and zoom level. The map is built in layers, with a <code>TileLayer</code> for the base map and a <code>MarkerLayer</code> for displaying markers.</p>
<p>The Marker object is created using the current latitude and longitude from the <code>LocationProvider</code> and a red location pin icon.</p>
<p>If the map is not yet available (i.e., no location has been fetched), we display a loading indicator.</p>
<p>Launch the app and test with different locations using the Android Studio emulator's extended controls as described earlier.</p>
<p><img alt="Map Screenshot" src="../images/location_map.png" /></p>
<div class="admonition question">
<p class="admonition-title">Task</p>
<p>Modify the <code>MapScreen</code> to include a button that starts/stops continuous location updates using the <code>startListening()</code> and <code>stopListening()</code> methods from the <code>LocationProvider</code>. The map must show the updated location as it changes.</p>
</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.expand", "content.code.copy"], "search": "../../assets/javascripts/workers/search.a264c092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.4e0fa4ba.min.js"></script>
      
    
  </body>
</html>