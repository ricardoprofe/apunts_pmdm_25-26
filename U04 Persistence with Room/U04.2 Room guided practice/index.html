
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Ricardo SÃ¡nchez">
      
      
      
        <link rel="prev" href="../U04.1%20Persistence%20with%20Room/">
      
      
        <link rel="next" href="../U04.3%20Relationships/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.0">
    
    
      
        <title>Unit 4.2. Room guided practice - Multimedia and mobile device programming - 2DAM</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.9f615399.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.649f08f9.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Noto Sans";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/my.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="cyan" data-md-color-accent="amber">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#unit-42-room-guided-practice" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Multimedia and mobile device programming - 2DAM" class="md-header__button md-logo" aria-label="Multimedia and mobile device programming - 2DAM" data-md-component="logo">
      
  <img src="../../stylesheets/logo_me_blanc.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Multimedia and mobile device programming - 2DAM
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Unit 4.2. Room guided practice
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Multimedia and mobile device programming - 2DAM" class="md-nav__button md-logo" aria-label="Multimedia and mobile device programming - 2DAM" data-md-component="logo">
      
  <img src="../../stylesheets/logo_me_blanc.png" alt="logo">

    </a>
    Multimedia and mobile device programming - 2DAM
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multimedia and mobile device programming - 2DAM
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    U01 Introduction to Mobile Development
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            U01 Introduction to Mobile Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U01%20Introduction%20to%20Mobile%20Development/UD1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 01. Introduction to Mobile Development.
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    U02 Android basics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            U02 Android basics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U02%20Android%20basics/U02.1%20-%20Kotlin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 2.1. The Kotlin language
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U02%20Android%20basics/U02.2%20Basic%20Android/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 2.2. Basic Android development
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    U03 Android architecture
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            U03 Android architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U03%20Android%20architecture/U03.1%20Android%20architecture%20copy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 3.1. Android architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U03%20Android%20architecture/U03.2%20The%20MVVM%20pattern/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 3.2 The MVVM design pattern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U03%20Android%20architecture/U03.3%20ViewModel%20guided%20practice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 3.3 ViewModel guided practice
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U03%20Android%20architecture/U03.4%20Navigation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 3.4 Navigation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U03%20Android%20architecture/U03.5%20Navigation%20guided%20practice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 3.5 Navigation guided practice
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    U04 Persistence with Room
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            U04 Persistence with Room
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../U04.1%20Persistence%20with%20Room/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 4.1. Persistence with Room
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Unit 4.2. Room guided practice
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Unit 4.2. Room guided practice
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-data-layer" class="md-nav__link">
    The data layer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-add-room-dependencies" class="md-nav__link">
    1. Add Room dependencies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-create-the-entity" class="md-nav__link">
    2. Create the Entity
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-create-the-dao" class="md-nav__link">
    3. Create the DAO
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-create-the-database" class="md-nav__link">
    4. Create the Database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-create-the-repository" class="md-nav__link">
    5. Create the Repository
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-add-the-save-functionality-to-the-viewmodel" class="md-nav__link">
    6. Add the save functionality to the ViewModel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-save-from-the-ui" class="md-nav__link">
    7. Save from the UI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-add-a-list-screen" class="md-nav__link">
    8. Add a list screen
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-edit-tips" class="md-nav__link">
    9. Edit tips
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-adding-tips" class="md-nav__link">
    10. Adding tips
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-deleting-tips" class="md-nav__link">
    11. Deleting tips
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-fixing-state-issues" class="md-nav__link">
    12. Fixing state issues
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#improvements" class="md-nav__link">
    Improvements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#source-code" class="md-nav__link">
    Source code
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../U04.3%20Relationships/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 4.3. Relationships with Room
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../U04.4%20More/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 4.4. More about Android development
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    U05 Multiplatform development with Flutter
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            U05 Multiplatform development with Flutter
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U05%20Multiplatform%20development%20with%20Flutter/U05.1%20Introduction%20to%20Flutter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 5.1. Introduction to Flutter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U05%20Multiplatform%20development%20with%20Flutter/U05.2%20Flutter%20Architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 5.2. Flutter Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U05%20Multiplatform%20development%20with%20Flutter/U05.3%20Geolocation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 5.3. Geolocation with Flutter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U05%20Multiplatform%20development%20with%20Flutter/U05.4%20Mobile%20sensors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 5.4. Mobile sensors with Flutter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U05%20Multiplatform%20development%20with%20Flutter/U05.5%20Camera/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 5.5. Camera with Flutter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U05%20Multiplatform%20development%20with%20Flutter/U05.6%20Files%20storage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 5.6. Files storage with Flutter
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    U06 Connectivity and remote applications
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            U06 Connectivity and remote applications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U06%20Connectivity%20and%20remote%20applications/U06.1%20Introduction%20to%20Firebase%20and%20Firestore/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 6.1 Introduction to Firebase and Firestore
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U06%20Connectivity%20and%20remote%20applications/U06.2%20Using%20Firestore/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 6.2 Using Firestore
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U06%20Connectivity%20and%20remote%20applications/U06.3%20Firebase%20authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 6.3 Using Firebase Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U06%20Connectivity%20and%20remote%20applications/U06.4%20Analytics%20and%20Crashlytics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 6.4 Analytics and Crashlytics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U06%20Connectivity%20and%20remote%20applications/U06.5%20Connectivity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 6.5 Connectivity
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    U07 Introduction to game engines
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            U07 Introduction to game engines
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U07%20Introduction%20to%20game%20engines/U07.1%20Introduction%20to%20Game%20Engines/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 7.1 Introduction to Game Engines
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    U08 Videogames development
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            U08 Videogames development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U08%20Videogames%20development/U08.1%20Introduction%20to%20GDScript/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 8.1 Introduction to GDScript
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U08%20Videogames%20development/U08.2%20Basic%20movement/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 8.2 Basic movement
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U08%20Videogames%20development/U08.3%20Animations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 8.3 Animations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U08%20Videogames%20development/U08.4%20Nodes%20and%20scenes%20instancing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 8.4 Nodes and scenes instancing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U08%20Videogames%20development/U08.5%20Collisions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 8.5 Collisions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U08%20Videogames%20development/U08.6%20Camera%20and%20parallax/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 8.6 Camera and parallax
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-data-layer" class="md-nav__link">
    The data layer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-add-room-dependencies" class="md-nav__link">
    1. Add Room dependencies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-create-the-entity" class="md-nav__link">
    2. Create the Entity
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-create-the-dao" class="md-nav__link">
    3. Create the DAO
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-create-the-database" class="md-nav__link">
    4. Create the Database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-create-the-repository" class="md-nav__link">
    5. Create the Repository
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-add-the-save-functionality-to-the-viewmodel" class="md-nav__link">
    6. Add the save functionality to the ViewModel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-save-from-the-ui" class="md-nav__link">
    7. Save from the UI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-add-a-list-screen" class="md-nav__link">
    8. Add a list screen
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-edit-tips" class="md-nav__link">
    9. Edit tips
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-adding-tips" class="md-nav__link">
    10. Adding tips
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-deleting-tips" class="md-nav__link">
    11. Deleting tips
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-fixing-state-issues" class="md-nav__link">
    12. Fixing state issues
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#improvements" class="md-nav__link">
    Improvements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#source-code" class="md-nav__link">
    Source code
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="unit-42-room-guided-practice">Unit 4.2. Room guided practice</h1>
<p>In this guided practice, you will enhance the Tip Time app by adding data persistence using Room. You will create a database to store tip calculations and retrieve them later.</p>
<p><img alt="Data layer" src="../images/data_layer.png" /></p>
<h2 id="the-data-layer">The data layer</h2>
<p>The data layer will consist of the following components:</p>
<ol>
<li><strong>Entity</strong>: Represents a table within the database. Each entity is a data class annotated with <code>@Entity</code>.</li>
<li><strong>DAO (Data Access Object)</strong>: Provides methods for accessing the database. DAOs are interfaces annotated with <code>@Dao</code>.</li>
<li><strong>Database</strong>: The main database class that holds the database and serves as the main access point for the underlying SQLite database. It is annotated with <code>@Database</code>.</li>
<li><strong>Repository</strong>: A class that abstracts access to multiple data sources. It mediates between the data layer and the rest of the app.</li>
</ol>
<p>We will create a new package named <code>data</code> to hold these components.</p>
<h2 id="1-add-room-dependencies">1. Add Room dependencies</h2>
<p>First, declare the KSP plugin in your top level <code>build.gradle.kts</code> file:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">plugins</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">//Previously declared plugins</span>
<span class="w">    </span><span class="n">id</span><span class="p">(</span><span class="s">&quot;com.google.devtools.ksp&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="s">&quot;2.0.21-1.0.27&quot;</span><span class="w"> </span><span class="n">apply</span><span class="w"> </span><span class="kc">false</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Then, enable KSP in your app-level <code>build.gradle.kts</code> file:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//Previously declared plugins</span>
<span class="n">plugins</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">id</span><span class="p">(</span><span class="s">&quot;com.google.devtools.ksp&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Finally, add the following Room dependencies to your <code>build.gradle</code> file:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">dependencies</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">room_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2.8.3&quot;</span>

<span class="w">    </span><span class="c1">// Previous dependencies</span>

<span class="w">    </span><span class="c1">//Room</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;androidx.room:room-runtime:</span><span class="si">$</span><span class="n">room_version</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">ksp</span><span class="p">(</span><span class="s">&quot;androidx.room:room-compiler:</span><span class="si">$</span><span class="n">room_version</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;androidx.room:room-ktx:</span><span class="si">$</span><span class="n">room_version</span><span class="s">&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Sync your project to download the dependencies.</p>
<h2 id="2-create-the-entity">2. Create the Entity</h2>
<p>In the <code>data</code> package, create a new Kotlin data class named <code>Tip</code> to represent the tip calculation entity. Annotate the class with <code>@Entity</code> and define the necessary fields:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//Tip.kt</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.room.Entity</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.room.PrimaryKey</span>

<span class="nd">@Entity</span><span class="p">(</span><span class="n">tableName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;tips&quot;</span><span class="p">)</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Tip</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@PrimaryKey</span><span class="p">(</span><span class="n">autoGenerate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">id</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">billAmount</span><span class="p">:</span><span class="w"> </span><span class="kt">Double</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">tipPercentage</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">roundUp</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>As you can see, we use annotations to define the table name. That means that Room will create and use a table named <code>tips</code> in the database.</p>
<p>The <code>id</code> field is annotated with <code>@PrimaryKey</code> and set to auto-generate, so Room will automatically assign a unique ID to each tip calculation.</p>
<h2 id="3-create-the-dao">3. Create the DAO</h2>
<p>In the <code>data</code> package, create a new Kotlin interface named <code>TipDao</code>. Annotate the interface with <code>@Dao</code> and define methods for inserting and retrieving tip calculations:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//TipDao.kt</span>

<span class="k">import</span><span class="w"> </span><span class="nn">androidx.room.Dao</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.room.Insert</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.room.Query</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.Flow</span>

<span class="nd">@Dao</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">TipDao</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="nd">@Query</span><span class="p">(</span><span class="s">&quot;SELECT * FROM tips ORDER BY id ASC&quot;</span><span class="p">)</span>
<span class="w">   </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getAllTips</span><span class="p">():</span><span class="w"> </span><span class="n">Flow</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Tip</span><span class="o">&gt;&gt;</span>

<span class="w">   </span><span class="nd">@Query</span><span class="p">(</span><span class="s">&quot;SELECT * FROM tips WHERE id = :id&quot;</span><span class="p">)</span>
<span class="w">   </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getTipById</span><span class="p">(</span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">):</span><span class="w"> </span><span class="n">Flow</span><span class="o">&lt;</span><span class="n">Tip?&gt;</span>

<span class="w">   </span><span class="nd">@Insert</span><span class="p">(</span><span class="n">onConflict</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OnConflictStrategy</span><span class="p">.</span><span class="na">IGNORE</span><span class="p">)</span>
<span class="w">   </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">insertTip</span><span class="p">(</span><span class="n">tip</span><span class="p">:</span><span class="w"> </span><span class="n">Tip</span><span class="p">)</span>

<span class="w">   </span><span class="nd">@Update</span>
<span class="w">   </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">updateTip</span><span class="p">(</span><span class="n">tip</span><span class="p">:</span><span class="w"> </span><span class="n">Tip</span><span class="p">)</span>

<span class="w">   </span><span class="nd">@Delete</span>
<span class="w">   </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">deleteTip</span><span class="p">(</span><span class="n">tip</span><span class="p">:</span><span class="w"> </span><span class="n">Tip</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Similar to the entity, we use annotations to define SQL queries for retrieving data from the database.</p>
<p>The select methods return a <code>Flow</code> of data, allowing us to observe changes in the database. They have the annotation <code>@Query</code> with the corresponding SQL query as a parameter.</p>
<p>The <strong>onConflict</strong> strategy for the insert method is set to <code>IGNORE</code>, meaning that if a conflict occurs (e.g., trying to insert a tip with an existing ID), the insertion will be ignored.</p>
<p>The insert, update, and delete methods are suspended functions, allowing them to be called from a coroutine.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>A <strong>suspended method</strong> is a special kind of function in Kotlin that can be paused and resumed at a later time. This is particularly useful for performing long-running operations, such as database operations or network requests, without blocking the main thread of the application.</p>
</div>
<h2 id="4-create-the-database">4. Create the Database</h2>
<p>In the <code>data</code> package, create a new Kotlin abstract class named <code>TipDatabase</code>. Annotate the class with <code>@Database</code> and define the database configuration:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//TipDatabase.kt</span>

<span class="nd">@Database</span><span class="p">(</span><span class="n">entities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">Tip</span><span class="o">::</span><span class="n">class</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">exportSchema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="kd">abstract</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">TipDatabase</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">RoomDatabase</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">abstract</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">tipDao</span><span class="p">():</span><span class="w"> </span><span class="n">TipDao</span>

<span class="w">    </span><span class="kd">companion</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="nd">@Volatile</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">Instance</span><span class="p">:</span><span class="w"> </span><span class="n">TipDatabase? </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>

<span class="w">        </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getDatabase</span><span class="p">(</span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="n">Context</span><span class="p">):</span><span class="w"> </span><span class="n">TipDatabase</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// if the Instance is not null, return it, otherwise create a new database instance.</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Instance</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="n">synchronized</span><span class="p">(</span><span class="k">this</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Room</span><span class="p">.</span><span class="na">databaseBuilder</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">TipDatabase</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;tip_database&quot;</span><span class="p">)</span><span class="w">                    </span>
<span class="w">                    </span><span class="p">.</span><span class="na">fallbackToDestructiveMigration</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">also</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">it</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>The database class must satisfy the following conditions:</p>
<ul>
<li>The class must be annotated with a <code>@Database</code> annotation that includes an <code>entities</code> array that lists all of the data entities associated with the database.</li>
<li>The class must be an abstract class that extends <code>RoomDatabase</code>.</li>
<li>For each DAO class that is associated with the database, the database class must define an abstract method that has zero arguments and returns an instance of the DAO class.</li>
</ul>
<p>The version number is set to 1. If you make changes to the database schema in the future, you will need to increment this version number, so that Room can handle the migration.</p>
<p>The method <code>getDatabase</code> implements the singleton pattern to ensure that only one instance of the database is created throughout the app's lifecycle. The <code>synchronized</code> block ensures that the database instance is created in a thread-safe manner.</p>
<p>The <code>Room.databaseBuilder</code> method is used to create the database instance, specifying the context, the database class, and the database name. The parameter <code>fallbackToDestructiveMigration(false)</code> indicates that Room should not delete the database if a migration is needed but not found.</p>
<h2 id="5-create-the-repository">5. Create the Repository</h2>
<p>A repository class abstracts access to multiple data sources. It mediates between the data layer and the rest of the app. It's not mandatory, but it's a good practice to use it.</p>
<p>In the <code>data</code> package, create a new Kotlin class named <code>TipRepository</code>. Define the repository class as follows:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//TipRepository.kt</span>

<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.Flow</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">TipRepository</span><span class="p">(</span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">tipDao</span><span class="p">:</span><span class="w"> </span><span class="n">TipDao</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getAllTips</span><span class="p">():</span><span class="w"> </span><span class="n">Flow</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Tip</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tipDao</span><span class="p">.</span><span class="na">getAllTips</span><span class="p">()</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getTipById</span><span class="p">(</span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">):</span><span class="w"> </span><span class="n">Flow</span><span class="o">&lt;</span><span class="n">Tip?&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tipDao</span><span class="p">.</span><span class="na">getTipById</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">insertTip</span><span class="p">(</span><span class="n">tip</span><span class="p">:</span><span class="w"> </span><span class="n">Tip</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tipDao</span><span class="p">.</span><span class="na">insertTip</span><span class="p">(</span><span class="n">tip</span><span class="p">)</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">updateTip</span><span class="p">(</span><span class="n">tip</span><span class="p">:</span><span class="w"> </span><span class="n">Tip</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tipDao</span><span class="p">.</span><span class="na">updateTip</span><span class="p">(</span><span class="n">tip</span><span class="p">)</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">deleteTip</span><span class="p">(</span><span class="n">tip</span><span class="p">:</span><span class="w"> </span><span class="n">Tip</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tipDao</span><span class="p">.</span><span class="na">deleteTip</span><span class="p">(</span><span class="n">tip</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>The data layer is done, you can run the app now to check that everything is working fine. No database operations are performed yet, so the app should work as before.</p>
<h2 id="6-add-the-save-functionality-to-the-viewmodel">6. Add the save functionality to the ViewModel</h2>
<p>Now that we have the data layer set up, we need to integrate it into the ViewModel to allow saving tip calculations.</p>
<p>In the <code>TipViewModel</code>, change the constructor to accept an Application context and inherit from <code>AndroidViewModel</code> instead of <code>ViewModel</code>. This will allow us to access the database instance.</p>
<p>Then, create an instance of the <code>TipRepository</code> using the <code>TipDatabase</code> and implement a method to save the tip calculation.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//TipTimeViewModel.kt</span>
<span class="k">import</span><span class="w"> </span><span class="nn">android.app.Application</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.AndroidViewModel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.viewModelScope</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.launch</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">TipTimeViewModel</span><span class="p">(</span><span class="n">application</span><span class="p">:</span><span class="w"> </span><span class="n">Application</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">AndroidViewModel</span><span class="p">(</span><span class="n">application</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">   </span>

<span class="w">    </span><span class="c1">// Existing properties and methods</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">tipRepository</span><span class="p">:</span><span class="w"> </span><span class="n">TipRepository</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TipRepository</span><span class="p">(</span>
<span class="w">        </span><span class="n">TipDatabase</span><span class="p">.</span><span class="na">getDatabase</span><span class="p">(</span><span class="n">application</span><span class="p">).</span><span class="na">tipDao</span><span class="p">()</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">saveTipCalculation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Launch a coroutine in the ViewModel&#39;s scope</span>
<span class="w">        </span><span class="n">viewModelScope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">tip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Tip</span><span class="p">(</span>
<span class="w">                </span><span class="n">billAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_uiState</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">amountInput</span><span class="p">.</span><span class="na">toDoubleOrNull</span><span class="p">()</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="m">0.0</span><span class="p">,</span>
<span class="w">                </span><span class="n">tipPercentage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_uiState</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">tipInput</span><span class="p">.</span><span class="na">toIntOrNull</span><span class="p">()</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="m">15</span><span class="p">,</span>
<span class="w">                </span><span class="n">roundUp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_uiState</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">roundUp</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">            </span><span class="c1">// Use the repository to insert the tip</span>
<span class="w">            </span><span class="n">tipRepository</span><span class="p">.</span><span class="na">insertTip</span><span class="p">(</span><span class="n">tip</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="7-save-from-the-ui">7. Save from the UI</h2>
<p>Finally, we need to call the <code>saveTipCalculation</code> method from the UI when the user wants to save a tip calculation. You can add a button in the UI that triggers this action.</p>
<p>For example, in your Composable function, change the <code>onNextButtonClicked</code> lambda to call the save method:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//TipTimeLayout.kt</span>

<span class="n">composable</span><span class="p">(</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Routes</span><span class="p">.</span><span class="na">Start</span><span class="p">.</span><span class="na">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">TipTimeStartScreen</span><span class="p">(</span>
<span class="w">        </span><span class="n">tipTimeViewModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tipTimeViewModel</span><span class="p">,</span>
<span class="w">        </span><span class="n">onNextButtonClicked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">tipTimeViewModel</span><span class="p">.</span><span class="na">saveTipCalculation</span><span class="p">()</span>
<span class="w">            </span><span class="n">navController</span><span class="p">.</span><span class="na">navigate</span><span class="p">(</span><span class="n">Routes</span><span class="p">.</span><span class="na">TipResult</span><span class="p">.</span><span class="na">name</span><span class="p">)</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">            </span><span class="p">.</span><span class="na">fillMaxSize</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">40.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<pre class="mermaid"><code>sequenceDiagram
    actor User

    User-&gt;&gt;+EditScreen: Clicks "Save"/"Update" Button
    EditScreen-&gt;&gt;+ViewModel: Calls saveTipCalculation()

    ViewModel-&gt;&gt;+Repository: Calls insertTip(tip) or updateTip(tip)
    Repository-&gt;&gt;+DAO: Calls insert(tip) or update(tip)
    DAO-&gt;&gt;+Database: Executes SQL INSERT or UPDATE statement
    Database--&gt;&gt;-DAO: Confirms operation success
    DAO--&gt;&gt;-Repository: Returns confirmation
    Repository--&gt;&gt;-ViewModel: Returns confirmation
    ViewModel--&gt;&gt;-EditScreen: (Completes coroutine scope)
</code></pre>
<h2 id="8-add-a-list-screen">8. Add a list screen</h2>
<p>Now that we have the ability to save tip calculations, let's add a new screen to display the list of saved tips.</p>
<p>Change the name of your <code>TipTimeStartScreen</code> to <code>TipTimeEditScreen</code>. Create a new screen with the name <code>TipTimeStartScreen</code>, that will contain a lazy column to show the list of saved tips.</p>
<p>Adjust your navigation to include the new screen:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//Routes.kt</span>

<span class="kd">enum</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Routes</span><span class="p">(</span><span class="nd">@StringRes</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">title</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Start</span><span class="w"> </span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">app_name</span><span class="p">),</span>
<span class="w">    </span><span class="n">EditTip</span><span class="w"> </span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">edit_tip</span><span class="p">),</span>
<span class="w">    </span><span class="n">TipResult</span><span class="w"> </span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">tip_result</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>The <code>TipTimeStartScreen</code> will contain the next composables:</p>
<ul>
<li><code>TipTimeStartScreen</code>: the main composable that contains the lazy column.</li>
<li><code>TipList</code>: the lazy column that displays the list of saved tips.</li>
<li><code>TipItem</code>: the individual item in the list that displays the tip details inside a card component.</li>
</ul>
<p>Lets see each composable implementation:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//TipTimeStartScreen.kt</span>

<span class="nd">@OptIn</span><span class="p">(</span><span class="n">ExperimentalMaterial3Api</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="nd">@Composable</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">TipTimeStartScreen</span><span class="p">(</span>
<span class="w">    </span><span class="n">onItemClick</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="kt">Int</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span><span class="p">,</span>
<span class="w">    </span><span class="n">modifier</span><span class="p">:</span><span class="w"> </span><span class="n">Modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">,</span>
<span class="w">    </span><span class="n">startViewModel</span><span class="p">:</span><span class="w"> </span><span class="n">StartViewModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewModel</span><span class="p">(),</span>
<span class="w">    </span><span class="n">contentPadding</span><span class="p">:</span><span class="w"> </span><span class="n">PaddingValues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PaddingValues</span><span class="p">(</span><span class="m">0.</span><span class="n">dp</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">uiState</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">startViewModel</span><span class="p">.</span><span class="na">uiState</span><span class="p">.</span><span class="na">collectAsState</span><span class="p">()</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">tipList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uiState</span><span class="p">.</span><span class="na">itemList</span>

<span class="w">    </span><span class="n">Column</span><span class="p">(</span>
<span class="w">        </span><span class="n">horizontalAlignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Alignment</span><span class="p">.</span><span class="na">CenterHorizontally</span><span class="p">,</span>
<span class="w">        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modifier</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tipList</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Text</span><span class="p">(</span>
<span class="w">                </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">no_tips_description</span><span class="p">),</span>
<span class="w">                </span><span class="n">textAlign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TextAlign</span><span class="p">.</span><span class="na">Center</span><span class="p">,</span>
<span class="w">                </span><span class="n">style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">typography</span><span class="p">.</span><span class="na">titleLarge</span><span class="p">,</span>
<span class="w">                </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="n">contentPadding</span><span class="p">),</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">TipList</span><span class="p">(</span>
<span class="w">                </span><span class="n">tipList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tipList</span><span class="p">,</span>
<span class="w">                </span><span class="n">onItemClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">onItemClick</span><span class="p">(</span><span class="nb">it</span><span class="p">.</span><span class="na">id</span><span class="p">)</span><span class="w"> </span><span class="p">},</span>
<span class="w">                </span><span class="n">contentPadding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">contentPadding</span><span class="p">,</span>
<span class="w">                </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="n">horizontal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>In this composable, we observe the <code>uiState</code> from the <code>StartViewModel</code> (that we will create later) to get the list of saved tips. If the list is empty, we display a message; otherwise, we show the <code>TipList</code> composable.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//TipTimeStartScreen.kt</span>

<span class="nd">@Composable</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">TipList</span><span class="p">(</span>
<span class="w">    </span><span class="n">tipList</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Tip</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="n">onItemClick</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">Tip</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span><span class="p">,</span>
<span class="w">    </span><span class="n">modifier</span><span class="p">:</span><span class="w"> </span><span class="n">Modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">,</span>
<span class="w">    </span><span class="n">contentPadding</span><span class="p">:</span><span class="w"> </span><span class="n">PaddingValues</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">LazyColumn</span><span class="p">(</span>
<span class="w">        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modifier</span><span class="p">,</span>
<span class="w">        </span><span class="n">contentPadding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">contentPadding</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">items</span><span class="p">(</span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tipList</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">tip</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="n">TipItem</span><span class="p">(</span><span class="n">tip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tip</span><span class="p">,</span>
<span class="w">                </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                    </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">6.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">clickable</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">onItemClick</span><span class="p">(</span><span class="n">tip</span><span class="p">)</span><span class="w"> </span><span class="p">})</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Here we are using a <code>LazyColumn</code> to display the list of tips. Each item in the list is represented by the <code>TipItem</code> composable. When we click on an item, we call the <code>onItemClick</code> lambda with the selected tip.</p>
<div class="admonition info">
<p class="admonition-title">LazyColumn</p>
<p>A <code>LazyColumn</code> is a vertically scrolling list that only composes and lays out the currently visible items. This makes it more efficient than a regular <code>Column</code> for displaying large lists of data, as it only creates the views that are currently needed.</p>
</div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//TipTimeStartScreen.kt</span>

<span class="nd">@Composable</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">TipItem</span><span class="p">(</span>
<span class="w">    </span><span class="n">tip</span><span class="p">:</span><span class="w"> </span><span class="n">Tip</span><span class="p">,</span>
<span class="w">    </span><span class="n">modifier</span><span class="p">:</span><span class="w"> </span><span class="n">Modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Card</span><span class="p">(</span>
<span class="w">        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modifier</span><span class="p">,</span>
<span class="w">        </span><span class="n">elevation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CardDefaults</span><span class="p">.</span><span class="na">cardElevation</span><span class="p">(</span><span class="n">defaultElevation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Column</span><span class="p">(</span>
<span class="w">            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">20.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">            </span><span class="n">verticalArrangement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrangement</span><span class="p">.</span><span class="na">spacedBy</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Text</span><span class="p">(</span>
<span class="w">                </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">bill_amount</span><span class="p">)</span><span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tip</span><span class="p">.</span><span class="na">billAmount</span><span class="p">,</span>
<span class="w">                </span><span class="n">style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">typography</span><span class="p">.</span><span class="na">bodyLarge</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">            </span><span class="n">Spacer</span><span class="p">(</span><span class="n">Modifier</span><span class="p">.</span><span class="na">weight</span><span class="p">(</span><span class="m">1f</span><span class="p">))</span>
<span class="w">            </span><span class="n">Text</span><span class="p">(</span>
<span class="w">                </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">tip_amount</span><span class="p">,</span><span class="w"> </span><span class="n">tip</span><span class="p">.</span><span class="na">tipPercentage</span><span class="p">),</span>
<span class="w">                </span><span class="n">style</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">typography</span><span class="p">.</span><span class="na">bodyMedium</span><span class="p">,</span>
<span class="w">                </span><span class="n">textAlign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TextAlign</span><span class="p">.</span><span class="na">End</span><span class="p">,</span>
<span class="w">                </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">fillMaxWidth</span><span class="p">()</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Here we define how each tip item looks. We use a <code>Card</code> component to display the tip details, including the bill amount and tip percentage, that we get from the <code>Tip</code> entity.</p>
<p>The <code>TipTimeStartScreen</code> will need a corresponding ViewModel to fetch the list of saved tips from the database. Create a new ViewModel named <code>StartViewModel</code> on the <code>ui.viewmodels</code> package:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">package</span><span class="w"> </span><span class="nn">com.example.tiptime.viewmodels</span>

<span class="k">import</span><span class="w"> </span><span class="nn">android.app.Application</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.AndroidViewModel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.viewModelScope</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.example.tiptime.data.Tip</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.example.tiptime.data.TipDatabase</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.example.tiptime.data.TipRepository</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.SharingStarted</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.StateFlow</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.map</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.stateIn</span>

<span class="cm">/**</span>
<span class="cm"> * ViewModel for the Start screen.</span>
<span class="cm"> */</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">StartViewModel</span><span class="p">(</span><span class="n">application</span><span class="p">:</span><span class="w"> </span><span class="n">Application</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">AndroidViewModel</span><span class="p">(</span><span class="n">application</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">tipRepository</span><span class="p">:</span><span class="w"> </span><span class="n">TipRepository</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TipRepository</span><span class="p">(</span>
<span class="w">        </span><span class="n">TipDatabase</span><span class="p">.</span><span class="na">getDatabase</span><span class="p">(</span><span class="n">application</span><span class="p">).</span><span class="na">tipDao</span><span class="p">()</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">uiState</span><span class="p">:</span><span class="w"> </span><span class="n">StateFlow</span><span class="o">&lt;</span><span class="n">StartUiState</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tipRepository</span><span class="p">.</span><span class="na">getAllTips</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">StartUiState</span><span class="p">(</span><span class="nb">it</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">.</span><span class="na">stateIn</span><span class="p">(</span>
<span class="w">            </span><span class="n">scope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewModelScope</span><span class="p">,</span>
<span class="w">            </span><span class="n">started</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SharingStarted</span><span class="p">.</span><span class="na">WhileSubscribed</span><span class="p">(</span><span class="m">5000</span><span class="p">),</span>
<span class="w">            </span><span class="n">initialValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StartUiState</span><span class="p">()</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">    </span><span class="kd">companion</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="c1">// Timeout for keeping the flow active while there are no subscribers.</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">TIMEOUT_MILLIS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="n">_000L</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * The UI state for the Start screen.</span>
<span class="cm"> */</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">StartUiState</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">itemList</span><span class="w"> </span><span class="p">:</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Tip</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">listOf</span><span class="p">()</span>
<span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>In the view model, we create an instance of the <code>TipRepository</code> to access the data layer. We define a <code>uiState</code> property that is a <code>StateFlow</code> of <code>StartUiState</code>, which contains the list of saved tips. The mapping function transforms the flow of tips from the repository into the UI state. The <code>stateIn</code> function is used to convert the flow into a state flow that can be observed by the UI.</p>
<p>The companion object contains a constant for the timeout duration when there are no subscribers to the flow.</p>
<p>In the same file we define the <code>StartUiState</code> data class, which holds the list of tips to be displayed in the UI.</p>
<p>Now, it's time to modify the navigation to include the new screen. In your <code>TipTimeLayout.kt</code> file, update the navigation graph to include the changes:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//TipTimeLayout.kt</span>

<span class="kd">fun</span><span class="w"> </span><span class="nf">TipTimeLayout</span><span class="p">(</span>
<span class="w">    </span><span class="n">tipTimeViewModel</span><span class="p">:</span><span class="w"> </span><span class="n">TipTimeViewModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewModel</span><span class="p">(),</span>
<span class="w">    </span><span class="n">startViewModel</span><span class="p">:</span><span class="w"> </span><span class="n">StartViewModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewModel</span><span class="p">(),</span><span class="w"> </span><span class="c1">// ADD THIS LINE</span>
<span class="w">    </span><span class="n">navController</span><span class="p">:</span><span class="w"> </span><span class="n">NavHostController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rememberNavController</span><span class="p">()</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">...</span>


<span class="w">    </span><span class="n">NavHost</span><span class="p">(</span>
<span class="w">        </span><span class="n">navController</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">navController</span><span class="p">,</span>
<span class="w">        </span><span class="n">startDestination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Routes</span><span class="p">.</span><span class="na">Start</span><span class="p">.</span><span class="na">name</span><span class="p">,</span>
<span class="w">        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="n">innerPadding</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">composable</span><span class="p">(</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Routes</span><span class="p">.</span><span class="na">Start</span><span class="p">.</span><span class="na">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">TipTimeStartScreen</span><span class="p">(</span>
<span class="w">                </span><span class="n">startViewModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">startViewModel</span><span class="p">,</span>
<span class="w">                </span><span class="n">onItemClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">navController</span><span class="p">.</span><span class="na">navigate</span><span class="p">(</span><span class="n">Routes</span><span class="p">.</span><span class="na">EditTip</span><span class="p">.</span><span class="na">name</span><span class="p">)},</span>
<span class="w">                </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                    </span><span class="p">.</span><span class="na">fillMaxSize</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">40.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">composable</span><span class="p">(</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Routes</span><span class="p">.</span><span class="na">EditTip</span><span class="p">.</span><span class="na">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">TipTimeEditScreen</span><span class="p">(</span>
<span class="w">                </span><span class="n">tipTimeViewModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tipTimeViewModel</span><span class="p">,</span>
<span class="w">                </span><span class="n">onNextButtonClicked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">tipTimeViewModel</span><span class="p">.</span><span class="na">saveTipCalculation</span><span class="p">()</span>
<span class="w">                    </span><span class="n">navController</span><span class="p">.</span><span class="na">navigate</span><span class="p">(</span><span class="n">Routes</span><span class="p">.</span><span class="na">TipResult</span><span class="p">.</span><span class="na">name</span><span class="p">)</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                    </span><span class="p">.</span><span class="na">fillMaxSize</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">40.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// Rest of the navigation graph</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Note how in the <code>onNextButtonClicked</code> lambda of the <code>TipTimeEditScreen</code>, we call the <code>saveTipCalculation</code> method before navigating to the <code>TipResult</code> screen.</p>
<p>This should be enough. Check that everything is working fine by running the app. You should be able to save tip calculations and see them listed in the start screen.</p>
<p>However, when you open a tip element, it does not show the details of the tip. We will solve it in the next point.</p>
<h2 id="9-edit-tips">9. Edit tips</h2>
<p>For editing tips, we need to modify the <code>TipTimeEditScreen</code> to accept a tip ID and load the corresponding tip details from the database.</p>
<p>From the <code>TipTimeLayout.kt</code> we need to pass the tip ID when navigating to the <code>TipTimeEditScreen</code>. Then, we will load the tip details in the ViewModel based on the passed ID, with the repository method <code>getTipById</code>.</p>
<p>First, modify the Routes enum to include a parameter for the tip ID and a string resource for the route:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//Routes.kt</span>

<span class="kd">enum</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Routes</span><span class="p">(</span><span class="nd">@StringRes</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">title</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">route</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Start</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">app_name</span><span class="p">,</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Start&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">EditTip</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">edit_tip</span><span class="p">,</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;EditTip&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">TipResult</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">tip_result</span><span class="p">,</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;TipResult&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="kd">companion</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">TIP_ID_ARG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;tipId&quot;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * The route pattern that accepts a tip id argument, e.g. &quot;EditTip/{tipId}&quot;</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">withArg</span><span class="p">():</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;</span><span class="si">$</span><span class="n">route</span><span class="s">/{</span><span class="si">$</span><span class="n">TIP_ID_ARG</span><span class="s">}&quot;</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Build a concrete route for the given id, e.g. &quot;EditTip/3&quot;</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">createRouteFor</span><span class="p">(</span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">):</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;</span><span class="si">$</span><span class="n">route</span><span class="s">/</span><span class="si">$</span><span class="n">id</span><span class="s">&quot;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>This code still maintains the string resource for the title, but now also includes a <code>route</code> property for each enum value. The <code>withArg</code> method constructs a route pattern that includes a placeholder for the tip ID, while the <code>createRouteFor</code> method generates a concrete route by substituting the placeholder with an actual tip ID.</p>
<p>In the <code>TipTimeLayout</code> composable, modify the <code>currentScreen</code> variable to use the new route property:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//TipTimeLayout.kt</span>

<span class="c1">// Resolve a route string for the current entry (may include concrete id like &quot;EditTip/3&quot;)</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">currentRoute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">backStackEntry</span><span class="o">?.</span><span class="na">destination</span><span class="o">?.</span><span class="na">route</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="n">Routes</span><span class="p">.</span><span class="na">Start</span><span class="p">.</span><span class="na">route</span>

<span class="c1">// Map the route string to our Routes enum, handling both plain and &quot;withArg&quot; patterns</span>
<span class="kd">val</span><span class="w"> </span><span class="nv">currentScreen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Routes</span><span class="p">.</span><span class="na">values</span><span class="p">().</span><span class="na">firstOrNull</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="n">currentRoute</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="na">route</span><span class="w"> </span><span class="o">||</span>
<span class="w">        </span><span class="n">currentRoute</span><span class="p">.</span><span class="na">startsWith</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="na">route</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span>
<span class="w">        </span><span class="n">currentRoute</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="na">withArg</span><span class="p">()</span>
<span class="p">}</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="n">Routes</span><span class="p">.</span><span class="na">Start</span>
</code></pre></div></td></tr></table></div>
<p>This code modifies the way the current screen is determined by checking if the current route matches either the base route or starts with the base route followed by a slash (indicating a concrete ID).</p>
<p>In the composable for the Start screen, modify the navigation to pass the tip ID when navigating to the EditTip screen:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//TipTimeLayout.kt</span>

<span class="n">composable</span><span class="p">(</span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Routes</span><span class="p">.</span><span class="na">Start</span><span class="p">.</span><span class="na">route</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">TipTimeStartScreen</span><span class="p">(</span>
<span class="w">        </span><span class="n">startViewModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">startViewModel</span><span class="p">,</span>
<span class="w">        </span><span class="c1">// Navigate to EditTip with the selected tip id using the helper</span>
<span class="w">        </span><span class="n">onItemClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">navController</span><span class="p">.</span><span class="na">navigate</span><span class="p">(</span><span class="n">Routes</span><span class="p">.</span><span class="na">EditTip</span><span class="p">.</span><span class="na">createRouteFor</span><span class="p">(</span><span class="n">id</span><span class="p">))</span><span class="w"> </span><span class="p">},</span>
<span class="w">        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">            </span><span class="p">.</span><span class="na">fillMaxSize</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">40.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Here, we use the <code>createRouteFor</code> method to generate the navigation route with the selected tip ID.</p>
<p>In the composable for the <code>EditTip</code> screen, modify the route to accept the tip ID argument and retrieve it from the back stack entry. We also modify the onClick lambda to save/update the tip in the database:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//TipTimeLayout.kt</span>

<span class="c1">// EditTip route now accepts a path parameter using the enum helper</span>
<span class="n">composable</span><span class="p">(</span>
<span class="w">    </span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Routes</span><span class="p">.</span><span class="na">EditTip</span><span class="p">.</span><span class="na">withArg</span><span class="p">(),</span>
<span class="w">    </span><span class="n">arguments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">listOf</span><span class="p">(</span><span class="n">navArgument</span><span class="p">(</span><span class="n">Routes</span><span class="p">.</span><span class="na">TIP_ID_ARG</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NavType</span><span class="p">.</span><span class="na">IntType</span><span class="w"> </span><span class="p">})</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">backStackEntry</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">tipId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">backStackEntry</span><span class="p">.</span><span class="na">arguments</span><span class="o">?.</span><span class="na">getInt</span><span class="p">(</span><span class="n">Routes</span><span class="p">.</span><span class="na">TIP_ID_ARG</span><span class="p">)</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="m">0</span>
<span class="w">    </span><span class="n">TipTimeEditScreen</span><span class="p">(</span>
<span class="w">        </span><span class="n">tipTimeViewModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tipTimeViewModel</span><span class="p">,</span>
<span class="w">        </span><span class="n">onNextButtonClicked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">tipTimeViewModel</span><span class="p">.</span><span class="na">saveTipCalculation</span><span class="p">()</span>
<span class="w">            </span><span class="n">navController</span><span class="p">.</span><span class="na">navigate</span><span class="p">(</span><span class="n">Routes</span><span class="p">.</span><span class="na">TipResult</span><span class="p">.</span><span class="na">route</span><span class="p">)</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="n">tipId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tipId</span><span class="p">,</span>
<span class="w">        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">            </span><span class="p">.</span><span class="na">fillMaxSize</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">40.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Here, we define the route to accept an integer argument for the tip ID. We retrieve the tip ID from the back stack entry's arguments and pass it to the <code>TipTimeEditScreen</code> composable.</p>
<p>In the <code>TipTimeEditScreen</code>, add a new argument for the tip ID and load the tip details in the ViewModel:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">fun</span><span class="w"> </span><span class="nf">TipTimeEditScreen</span><span class="p">(</span>
<span class="w">    </span><span class="n">onNextButtonClicked</span><span class="p">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span><span class="p">,</span>
<span class="w">    </span><span class="n">modifier</span><span class="p">:</span><span class="w"> </span><span class="n">Modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">,</span>
<span class="w">    </span><span class="n">tipTimeViewModel</span><span class="p">:</span><span class="w"> </span><span class="n">TipTimeViewModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewModel</span><span class="p">(),</span>
<span class="w">    </span><span class="n">tipId</span><span class="p">:</span><span class="w"> </span><span class="kt">Int?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Use LaunchedEffect to load the tip when the screen is first displayed</span>
<span class="w">    </span><span class="n">LaunchedEffect</span><span class="p">(</span><span class="n">tipId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tipId</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">tipId</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Assuming 0 is not a valid ID</span>
<span class="w">            </span><span class="n">tipTimeViewModel</span><span class="p">.</span><span class="na">loadTipById</span><span class="p">(</span><span class="n">tipId</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">tipTimeViewModel</span><span class="p">.</span><span class="na">resetTip</span><span class="p">()</span><span class="w"> </span><span class="c1">// Optional: Clear fields for a new tip</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Rest of the composable code</span>
</code></pre></div></td></tr></table></div>
<p>Here, we use <code>LaunchedEffect</code> to load the tip details when the screen is first displayed. If a valid tip ID is provided, we call the <code>loadTipById</code> method in the ViewModel to fetch the tip details. If the tip ID is 0 or null, we reset the fields for a new tip.</p>
<div class="admonition info">
<p class="admonition-title">LaunchedEffect</p>
<p><code>LaunchedEffect</code> is a composable function in Jetpack Compose that allows you to run suspend functions or side effects in response to changes in the composition. It is typically used to perform actions that should occur when a specific key or set of keys change.<br />
<a href="https://developer.android.com/reference/kotlin/androidx/compose/runtime/package-summary#LaunchedEffect(kotlin.Any,kotlin.coroutines.SuspendFunction1)">LaunchedEffect</a></p>
</div>
<p>Another modification is done in the Next button click lambda to call the <code>saveTipCalculation</code> method:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//TipTimeEditScreen.kt</span>

<span class="c1">//Previous composables</span>
<span class="n">Button</span><span class="p">(</span>
<span class="w">    </span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">onNextButtonClicked</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Change button text based on whether it&#39;s a new tip or an edit</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">buttonText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tipId</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">tipId</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">stringResource</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">update</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">stringResource</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">save</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">Text</span><span class="p">(</span><span class="n">buttonText</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Finally, in the <code>TipTimeViewModel</code>, we need new methods to load a tip by its ID and reset or update the tip fields.</p>
<p>First, add a new property to hold the currently loaded tip:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">private</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">currentTipId</span><span class="p">:</span><span class="w"> </span><span class="kt">Int?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
</code></pre></div></td></tr></table></div>
<p>The <code>loadTipById</code> method fetches the tip from the repository and updates the UI state:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">fun</span><span class="w"> </span><span class="nf">loadTipById</span><span class="p">(</span><span class="n">tipId</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">currentTipId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tipId</span>
<span class="w">    </span><span class="n">viewModelScope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Fetch the tip from the repository</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">tip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tipRepository</span><span class="p">.</span><span class="na">getTipById</span><span class="p">(</span><span class="n">tipId</span><span class="p">).</span><span class="na">firstOrNull</span><span class="p">()</span>
<span class="w">        </span><span class="n">tip</span><span class="o">?.</span><span class="na">let</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Update the UI state with the fetched tip data</span>
<span class="w">            </span><span class="n">_uiState</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">currentState</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">currentState</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                    </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">id</span><span class="p">,</span>
<span class="w">                    </span><span class="n">amountInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">billAmount</span><span class="p">.</span><span class="na">toString</span><span class="p">(),</span>
<span class="w">                    </span><span class="n">tipInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">tipPercentage</span><span class="p">.</span><span class="na">toString</span><span class="p">(),</span>
<span class="w">                    </span><span class="n">roundUp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">roundUp</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="c1">// Recalculate tip and total for the loaded values</span>
<span class="w">            </span><span class="n">calculateTip</span><span class="p">()</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="admonition info">
<p class="admonition-title"><strong>let</strong> and <strong>scope functions</strong></p>
<p>The <code>let</code> function in Kotlin is a <strong>scope function</strong> that allows you to execute a block of code on an object and return the result of the block. It is often used for null-checking and chaining operations on an object.<br />
<a href="https://kotlinlang.org/docs/scope-functions.html#let">let function</a><br />
<a href="https://kotlinlang.org/docs/scope-functions.html">Scope functions</a></p>
</div>
<p>The <code>saveTipCalculation</code> method is modified to handle both insert and update operations based on whether a tip is being edited or created, depending on the value of <code>currentTipId</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">fun</span><span class="w"> </span><span class="nf">saveTipCalculation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Launch a coroutine in the ViewModel&#39;s scope</span>
<span class="w">    </span><span class="n">viewModelScope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">tip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Tip</span><span class="p">(</span>
<span class="w">            </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentTipId</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="c1">// Use currentTipId if it exists, otherwise 0 for a new entry</span>
<span class="w">            </span><span class="n">billAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_uiState</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">amountInput</span><span class="p">.</span><span class="na">toDoubleOrNull</span><span class="p">()</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="m">0.0</span><span class="p">,</span>
<span class="w">            </span><span class="n">tipPercentage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_uiState</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">tipInput</span><span class="p">.</span><span class="na">toIntOrNull</span><span class="p">()</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="m">15</span><span class="p">,</span>
<span class="w">            </span><span class="n">roundUp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_uiState</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">roundUp</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="c1">// Use the repository to insert the tip</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">currentTipId</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">currentTipId</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">tipRepository</span><span class="p">.</span><span class="na">insertTip</span><span class="p">(</span><span class="n">tip</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">tipRepository</span><span class="p">.</span><span class="na">updateTip</span><span class="p">(</span><span class="n">tip</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Finally, the <code>resetTip</code> method clears the current tip ID and resets the UI state. It is called when creating a new tip and the tip id is 0 or null:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">fun</span><span class="w"> </span><span class="nf">resetTip</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">currentTipId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="n">_uiState</span><span class="p">.</span><span class="na">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TipTimeState</span><span class="p">()</span><span class="w"> </span><span class="c1">// Reset to default state</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Check that everything is working fine by running the app. You should be able to <strong>update</strong> tips loaded from the list.</p>
<h2 id="10-adding-tips">10. Adding tips</h2>
<p>To add a new tip, we need a FAB button on the <code>TipTimeLayout</code> that navigates to the <code>EditTip</code> screen without passing an id with the value of 0:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//TipTimeLayout.kt</span>

<span class="n">Scaffold</span><span class="p">(</span>
<span class="w">    </span><span class="n">topBar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">//TopBar content</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="n">floatingActionButton</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Add a FAB only on the Start screen</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">currentScreen</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Routes</span><span class="p">.</span><span class="na">Start</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">androidx</span><span class="p">.</span><span class="na">compose</span><span class="p">.</span><span class="na">material3</span><span class="p">.</span><span class="na">FloatingActionButton</span><span class="p">(</span>
<span class="w">                </span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">navController</span><span class="p">.</span><span class="na">navigate</span><span class="p">(</span><span class="n">Routes</span><span class="p">.</span><span class="na">EditTip</span><span class="p">.</span><span class="na">createRouteFor</span><span class="p">(</span><span class="m">0</span><span class="p">))</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Icon</span><span class="p">(</span>
<span class="w">                    </span><span class="n">imageVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Icons</span><span class="p">.</span><span class="na">Default</span><span class="p">.</span><span class="na">Add</span><span class="p">,</span>
<span class="w">                    </span><span class="n">contentDescription</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stringResource</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">add_tip</span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="11-deleting-tips">11. Deleting tips</h2>
<p>For delete an existing tip, we need a button in the <code>TipTimeEditScreen</code> that calls a new method in the ViewModel to delete the current tip. This button should only be visible when editing an existing tip (i.e., when <code>tipId</code> is not null or 0).</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//TipTimeEditScreen.kt</span>

<span class="c1">// Add a delete button if editing an existing tip</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tipId</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">tipId</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Spacer</span><span class="p">(</span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">height</span><span class="p">(</span><span class="m">16.</span><span class="n">dp</span><span class="p">))</span>
<span class="w">    </span><span class="n">OutlinedButton</span><span class="p">(</span>
<span class="w">        </span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">tipTimeViewModel</span><span class="p">.</span><span class="na">deleteTip</span><span class="p">()</span>
<span class="w">            </span><span class="n">backNavitation</span><span class="p">()</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Text</span><span class="p">(</span><span class="n">stringResource</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">delete</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>We are calling a the backNavigation lambda to return to the previous screen after deleting the tip, but we need to passit as argument from the TipTimeLayout:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//TipTimeLayout.kt</span>

<span class="n">composable</span><span class="p">(</span>
<span class="w">    </span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Routes</span><span class="p">.</span><span class="na">EditTip</span><span class="p">.</span><span class="na">withArg</span><span class="p">(),</span>
<span class="w">    </span><span class="n">arguments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">listOf</span><span class="p">(</span><span class="n">navArgument</span><span class="p">(</span><span class="n">Routes</span><span class="p">.</span><span class="na">TIP_ID_ARG</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NavType</span><span class="p">.</span><span class="na">IntType</span><span class="w"> </span><span class="p">})</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">backStackEntry</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">tipId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">backStackEntry</span><span class="p">.</span><span class="na">arguments</span><span class="o">?.</span><span class="na">getInt</span><span class="p">(</span><span class="n">Routes</span><span class="p">.</span><span class="na">TIP_ID_ARG</span><span class="p">)</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="m">0</span>
<span class="w">    </span><span class="n">TipTimeEditScreen</span><span class="p">(</span>
<span class="w">        </span><span class="n">tipTimeViewModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tipTimeViewModel</span><span class="p">,</span>
<span class="w">        </span><span class="n">onNextButtonClicked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">tipTimeViewModel</span><span class="p">.</span><span class="na">saveTipCalculation</span><span class="p">()</span>
<span class="w">            </span><span class="n">navController</span><span class="p">.</span><span class="na">navigate</span><span class="p">(</span><span class="n">Routes</span><span class="p">.</span><span class="na">TipResult</span><span class="p">.</span><span class="na">route</span><span class="p">)</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="n">backNavigation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">navController</span><span class="p">.</span><span class="na">navigateUp</span><span class="p">()</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="c1">//ADD THIS LINE</span>
<span class="w">        </span><span class="n">tipId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tipId</span><span class="p">,</span>
<span class="w">        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">            </span><span class="p">.</span><span class="na">fillMaxSize</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">40.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>And in the TipTimeEditScreen composable, add the new argument:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//TipTimeEditScreen.kt</span>

<span class="kd">fun</span><span class="w"> </span><span class="nf">TipTimeEditScreen</span><span class="p">(</span>
<span class="w">    </span><span class="n">onNextButtonClicked</span><span class="p">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span><span class="p">,</span>
<span class="w">    </span><span class="n">backNavigation</span><span class="p">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span><span class="p">,</span><span class="w"> </span><span class="c1">// ADD THIS LINE</span>
<span class="w">    </span><span class="p">...</span>
</code></pre></div></td></tr></table></div>
<p>Finally, implement the <code>deleteTip</code> method in the <code>TipTimeViewModel</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//TipTimeViewModel.kt</span>

<span class="kd">fun</span><span class="w"> </span><span class="nf">deleteTip</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">tipId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentTipId</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="c1">// If no current tip, do nothing</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">tip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Tip</span><span class="p">(</span>
<span class="w">        </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tipId</span><span class="p">,</span>
<span class="w">        </span><span class="n">billAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_uiState</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">amountInput</span><span class="p">.</span><span class="na">toDoubleOrNull</span><span class="p">()</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="m">0.0</span><span class="p">,</span>
<span class="w">        </span><span class="n">tipPercentage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_uiState</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">tipInput</span><span class="p">.</span><span class="na">toIntOrNull</span><span class="p">()</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="m">15</span><span class="p">,</span>
<span class="w">        </span><span class="n">roundUp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_uiState</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">roundUp</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="n">viewModelScope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">tipRepository</span><span class="p">.</span><span class="na">deleteTip</span><span class="p">(</span><span class="n">tip</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Done! Check that everything is working fine by running the app. You should be able to delete existing tips.</p>
<h2 id="12-fixing-state-issues">12. Fixing state issues</h2>
<p>You can notice some sate issues when rotating the Edit Screen. To fix it, we need to save the current tip ID in the next files:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//TipTimeEditScreen.kt</span>

<span class="nd">@Composable</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">TipTimeEditScreen</span><span class="p">(</span>
<span class="w">    </span><span class="c1">// Existing parameters</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Use LaunchedEffect to load the tip when the screen is first displayed</span>
<span class="w">    </span><span class="n">LaunchedEffect</span><span class="p">(</span><span class="n">tipId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tipId</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">tipId</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Assuming 0 is not a valid ID</span>
<span class="w">            </span><span class="n">tipTimeViewModel</span><span class="p">.</span><span class="na">loadOrKeepTip</span><span class="p">(</span><span class="n">tipId</span><span class="p">)</span><span class="w">  </span><span class="c1">//CHANGE THIS</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">//tipTimeViewModel.resetTip() // DELETE THIS</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="p">...</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//TipTimeLayout.kt</span>

<span class="p">...</span>

<span class="n">floatingActionButton</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">currentScreen</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Routes</span><span class="p">.</span><span class="na">Start</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">androidx</span><span class="p">.</span><span class="na">compose</span><span class="p">.</span><span class="na">material3</span><span class="p">.</span><span class="na">FloatingActionButton</span><span class="p">(</span>
<span class="w">            </span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">tipTimeViewModel</span><span class="p">.</span><span class="na">resetTip</span><span class="p">()</span><span class="w"> </span><span class="c1">//ADD THIS</span>
<span class="w">                </span><span class="n">navController</span><span class="p">.</span><span class="na">navigate</span><span class="p">(</span><span class="n">Routes</span><span class="p">.</span><span class="na">EditTip</span><span class="p">.</span><span class="na">createRouteFor</span><span class="p">(</span><span class="m">0</span><span class="p">))</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="p">...</span>

<span class="w">    </span><span class="n">composable</span><span class="p">(</span><span class="n">route</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Routes</span><span class="p">.</span><span class="na">TipResult</span><span class="p">.</span><span class="na">route</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">TipTimeResultScreen</span><span class="p">(</span>
<span class="w">                </span><span class="n">tipTimeViewModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tipTimeViewModel</span><span class="p">,</span>
<span class="w">                </span><span class="n">onBackButtonClicked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">navController</span><span class="p">.</span><span class="na">navigate</span><span class="p">(</span><span class="n">Routes</span><span class="p">.</span><span class="na">Start</span><span class="p">.</span><span class="na">route</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="n">popUpTo</span><span class="p">(</span><span class="m">0</span><span class="p">)}</span>
<span class="w">                    </span><span class="n">tipTimeViewModel</span><span class="p">.</span><span class="na">resetTip</span><span class="p">()</span><span class="w"> </span><span class="c1">//ADD THIS</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                    </span><span class="p">.</span><span class="na">fillMaxSize</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="m">10.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//TipTimeViewModel.kt</span>

<span class="c1">//ADD THIS FUNCTION</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">loadOrKeepTip</span><span class="p">(</span><span class="n">tipId</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">currentTipId</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">currentTipId</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Assuming 0 is not a valid ID</span>
<span class="w">        </span><span class="n">loadTipById</span><span class="p">(</span><span class="n">tipId</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//TipTimeViewModel.kt</span>

<span class="c1">//MODIFY THIS FUNCTION</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">deleteTip</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">tipId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentTipId</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="c1">// If no current tip, do nothing</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">tip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Tip</span><span class="p">(</span>
<span class="w">        </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tipId</span><span class="p">,</span>
<span class="w">        </span><span class="n">billAmount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_uiState</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">amountInput</span><span class="p">.</span><span class="na">toDoubleOrNull</span><span class="p">()</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="m">0.0</span><span class="p">,</span>
<span class="w">        </span><span class="n">tipPercentage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_uiState</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">tipInput</span><span class="p">.</span><span class="na">toIntOrNull</span><span class="p">()</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="m">15</span><span class="p">,</span>
<span class="w">        </span><span class="n">roundUp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_uiState</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">roundUp</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="n">viewModelScope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">tipRepository</span><span class="p">.</span><span class="na">deleteTip</span><span class="p">(</span><span class="n">tip</span><span class="p">)</span>
<span class="w">        </span><span class="n">resetTip</span><span class="p">()</span><span class="w"> </span><span class="c1">//ADD THIS</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Basically, we ensure that the tip ID is only reset when navigating to the Edit screen for a new tip or when returning to the Start screen. This prevents the tip ID from being lost during configuration changes like screen rotations.</p>
<h2 id="improvements">Improvements</h2>
<p>The basic functionality is in place, but still some possible improvements to the app could be:</p>
<ul>
<li>Show snackbars to inform the user about successful save, update, or delete operations.</li>
<li>Improve navigation.</li>
<li>Disable the save/update button when the input fields are blank or invalid.</li>
<li>Add confirmation dialog before deleting a tip.</li>
</ul>
<h2 id="references">References</h2>
<p>In the codelab you can see more details about Room and how to use it in Android apps: <a href="https://developer.android.com/courses/pathways/android-basics-compose-unit-6-pathway-2">Use Room for data persistence</a></p>
<h2 id="source-code">Source code</h2>
<p><a href="https://github.com/ricardoprofe/tiptime_PMDM_25_26/tree/persistence">GitHub repository</a></p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.expand", "content.code.copy"], "search": "../../assets/javascripts/workers/search.a264c092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.4e0fa4ba.min.js"></script>
      
    
  </body>
</html>