
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Ricardo SÃ¡nchez">
      
      
      
        <link rel="prev" href="../../U03%20Android%20architecture/U03.5%20Navigation%20guided%20practice/">
      
      
        <link rel="next" href="../U04.2%20Room%20guided%20practice/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.0">
    
    
      
        <title>Unit 4.1. Persistence with Room - Multimedia and mobile device programming - 2DAM</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.9f615399.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.649f08f9.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Noto Sans";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/my.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="cyan" data-md-color-accent="amber">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#unit-41-android-persistence-with-room" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Multimedia and mobile device programming - 2DAM" class="md-header__button md-logo" aria-label="Multimedia and mobile device programming - 2DAM" data-md-component="logo">
      
  <img src="../../stylesheets/logo_me_blanc.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Multimedia and mobile device programming - 2DAM
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Unit 4.1. Persistence with Room
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Multimedia and mobile device programming - 2DAM" class="md-nav__button md-logo" aria-label="Multimedia and mobile device programming - 2DAM" data-md-component="logo">
      
  <img src="../../stylesheets/logo_me_blanc.png" alt="logo">

    </a>
    Multimedia and mobile device programming - 2DAM
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multimedia and mobile device programming - 2DAM
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    U01 Introduction to Mobile Development
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            U01 Introduction to Mobile Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U01%20Introduction%20to%20Mobile%20Development/UD1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 01. Introduction to Mobile Development.
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    U02 Android basics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            U02 Android basics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U02%20Android%20basics/U02.1%20-%20Kotlin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 2.1. The Kotlin language
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U02%20Android%20basics/U02.2%20Basic%20Android/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 2.2. Basic Android development
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    U03 Android architecture
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            U03 Android architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U03%20Android%20architecture/U03.1%20Android%20architecture%20copy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 3.1. Android architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U03%20Android%20architecture/U03.2%20The%20MVVM%20pattern/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 3.2 The MVVM design pattern
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U03%20Android%20architecture/U03.3%20ViewModel%20guided%20practice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 3.3 ViewModel guided practice
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U03%20Android%20architecture/U03.4%20Navigation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 3.4 Navigation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U03%20Android%20architecture/U03.5%20Navigation%20guided%20practice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 3.5 Navigation guided practice
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    U04 Persistence with Room
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            U04 Persistence with Room
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Unit 4.1. Persistence with Room
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Unit 4.1. Persistence with Room
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sqlite" class="md-nav__link">
    SQLite
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-data-layer" class="md-nav__link">
    The data layer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#room-components" class="md-nav__link">
    Room components
  </a>
  
    <nav class="md-nav" aria-label="Room components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#declaring-room-dependencies" class="md-nav__link">
    Declaring Room dependencies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#entity" class="md-nav__link">
    Entity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dao-data-access-object" class="md-nav__link">
    DAO (Data Access Object)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database" class="md-nav__link">
    Database
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#repository" class="md-nav__link">
    Repository
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-data-in-the-ui-layer" class="md-nav__link">
    Using the data in the UI layer
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../U04.2%20Room%20guided%20practice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 4.2. Room guided practice
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../U04.3%20Relationships/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 4.3. Relationships with Room
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../U04.4%20More/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 4.4. More about Android development
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    U05 Multiplatform development with Flutter
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            U05 Multiplatform development with Flutter
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U05%20Multiplatform%20development%20with%20Flutter/U05.1%20Introduction%20to%20Flutter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 5.1. Introduction to Flutter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U05%20Multiplatform%20development%20with%20Flutter/U05.2%20Flutter%20Architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 5.2. Flutter Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U05%20Multiplatform%20development%20with%20Flutter/U05.3%20Geolocation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 5.3. Geolocation with Flutter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U05%20Multiplatform%20development%20with%20Flutter/U05.4%20Mobile%20sensors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 5.4. Mobile sensors with Flutter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U05%20Multiplatform%20development%20with%20Flutter/U05.5%20Camera/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 5.5. Camera with Flutter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U05%20Multiplatform%20development%20with%20Flutter/U05.6%20Files%20storage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 5.6. Files storage with Flutter
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    U06 Connectivity and remote applications
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            U06 Connectivity and remote applications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U06%20Connectivity%20and%20remote%20applications/U06.1%20Introduction%20to%20Firebase%20and%20Firestore/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 6.1 Introduction to Firebase and Firestore
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U06%20Connectivity%20and%20remote%20applications/U06.2%20Using%20Firestore/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 6.2 Using Firestore
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U06%20Connectivity%20and%20remote%20applications/U06.3%20Firebase%20authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 6.3 Using Firebase Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U06%20Connectivity%20and%20remote%20applications/U06.4%20Analytics%20and%20Crashlytics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 6.4 Analytics and Crashlytics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U06%20Connectivity%20and%20remote%20applications/U06.5%20Connectivity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 6.5 Connectivity
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    U07 Introduction to game engines
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            U07 Introduction to game engines
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U07%20Introduction%20to%20game%20engines/U07.1%20Introduction%20to%20Game%20Engines/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 7.1 Introduction to Game Engines
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    U08 Videogames development
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            U08 Videogames development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U08%20Videogames%20development/U08.1%20Introduction%20to%20GDScript/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 8.1 Introduction to GDScript
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U08%20Videogames%20development/U08.2%20Basic%20movement/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 8.2 Basic movement
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U08%20Videogames%20development/U08.3%20Animations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 8.3 Animations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../U08%20Videogames%20development/U08.4%20Nodes%20and%20scenes%20instancing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit 8.4 Nodes and scenes instancing
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sqlite" class="md-nav__link">
    SQLite
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-data-layer" class="md-nav__link">
    The data layer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#room-components" class="md-nav__link">
    Room components
  </a>
  
    <nav class="md-nav" aria-label="Room components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#declaring-room-dependencies" class="md-nav__link">
    Declaring Room dependencies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#entity" class="md-nav__link">
    Entity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dao-data-access-object" class="md-nav__link">
    DAO (Data Access Object)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database" class="md-nav__link">
    Database
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#repository" class="md-nav__link">
    Repository
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-data-in-the-ui-layer" class="md-nav__link">
    Using the data in the UI layer
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="unit-41-android-persistence-with-room">Unit 4.1. Android persistence with Room</h1>
<p>Room is a persistence library that provides an abstraction layer over SQLite to allow fluent database access while harnessing the full power of SQLite. It simplifies the database interactions and provides compile-time checks of SQL queries, reducing the likelihood of runtime errors.</p>
<h2 id="sqlite">SQLite</h2>
<p><strong>SQLite</strong> is a lightweight, embedded relational database management system (RDBMS) that is widely used in mobile applications, including Android. It is a <strong>serverless database engine that stores data in a single file</strong> on the device's file system. SQLite supports standard SQL syntax and provides features such as transactions, indexing, and data types.</p>
<p>SQLite is similar to other relational database management systems, but it has some differences in the types of data.</p>
<p>In the next table you can see the mapping between SQLite data types and Java/Kotlin data types:</p>
<table>
<thead>
<tr>
<th>SQLite Data Type</th>
<th>Kotlin Data Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>INTEGER</td>
<td>Int, Long</td>
</tr>
<tr>
<td>REAL</td>
<td>Float, Double</td>
</tr>
<tr>
<td>TEXT</td>
<td>String</td>
</tr>
<tr>
<td>INTEGER (0 or 1)</td>
<td>Boolean</td>
</tr>
<tr>
<td>BLOB</td>
<td>Byte[]</td>
</tr>
<tr>
<td>NULL</td>
<td>null</td>
</tr>
</tbody>
</table>
<p>The tipical SQL operations are similar to other RDBMS.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">-- Insert a new record</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;John Doe&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">);</span>

<span class="c1">-- Query records</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12</span><span class="p">;</span>

<span class="c1">-- Update a record</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">;</span>

<span class="c1">-- Delete a record</span>
<span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;John Doe&#39;</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<h2 id="the-data-layer">The data layer</h2>
<p>The data layer is responsible for managing the app's data, including storing, retrieving, and updating data. In Android, the data layer can be implemented using various technologies, such as <strong>SQLite</strong>, <strong>Room</strong>, <strong>SharedPreferences</strong>, or <strong>network APIs</strong>.</p>
<p><img alt="Data Layer" src="../images/data_layer.png" /></p>
<p>In this unit, we will focus on using <strong>Room</strong> as the data layer for Android applications.</p>
<h2 id="room-components">Room components</h2>
<p>Room is an <strong>ORM</strong> (<em>Object Relational Mapping</em>) library that provides an abstraction layer over SQLite. It simplifies database access and provides compile-time checks for SQL queries.</p>
<p>Room consists of three main components: <strong>Entity</strong>, <strong>DAO (Data Access Object)</strong>, and <strong>Database</strong>.</p>
<p><img alt="Room Components" src="../images/room.png" /></p>
<h3 id="declaring-room-dependencies">Declaring Room dependencies</h3>
<p>To use Room in your Android project, you need to add the following dependencies to your <code>build.gradle</code> file:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">dependencies</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">room_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2.8.3&quot;</span>

<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;androidx.room:room-runtime:</span><span class="si">$</span><span class="n">room_version</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// If this project uses any Kotlin source, use Kotlin Symbol Processing (KSP)</span>
<span class="w">    </span><span class="c1">// See Add the KSP plugin to your project</span>
<span class="w">    </span><span class="n">ksp</span><span class="p">(</span><span class="s">&quot;androidx.room:room-compiler:</span><span class="si">$</span><span class="n">room_version</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// If this project only uses Java source, use the Java annotationProcessor</span>
<span class="w">    </span><span class="c1">// No additional plugins are necessary</span>
<span class="w">    </span><span class="n">annotationProcessor</span><span class="p">(</span><span class="s">&quot;androidx.room:room-compiler:</span><span class="si">$</span><span class="n">room_version</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// optional - Kotlin Extensions and Coroutines support for Room</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;androidx.room:room-ktx:</span><span class="si">$</span><span class="n">room_version</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// optional - RxJava2 support for Room</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;androidx.room:room-rxjava2:</span><span class="si">$</span><span class="n">room_version</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// optional - RxJava3 support for Room</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;androidx.room:room-rxjava3:</span><span class="si">$</span><span class="n">room_version</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// optional - Guava support for Room, including Optional and ListenableFuture</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;androidx.room:room-guava:</span><span class="si">$</span><span class="n">room_version</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// optional - Test helpers</span>
<span class="w">    </span><span class="n">testImplementation</span><span class="p">(</span><span class="s">&quot;androidx.room:room-testing:</span><span class="si">$</span><span class="n">room_version</span><span class="s">&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// optional - Paging 3 Integration</span>
<span class="w">    </span><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;androidx.room:room-paging:</span><span class="si">$</span><span class="n">room_version</span><span class="s">&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>For adding KSP to your project, include the following in your top-level <code>build.gradle</code> file:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">plugins</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">//Previously declared plugins</span>
<span class="w">    </span><span class="n">id</span><span class="p">(</span><span class="s">&quot;com.google.devtools.ksp&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="s">&quot;2.0.21-1.0.27&quot;</span><span class="w"> </span><span class="n">apply</span><span class="w"> </span><span class="kc">false</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Then, enable KSP in your app-level <code>build.gradle.kts</code> file:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">//Previously declared plugins</span>
<span class="n">plugins</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">id</span><span class="p">(</span><span class="s">&quot;com.google.devtools.ksp&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p><strong>KSP</strong> (<em>Kotlin Symbol Processing</em>) is a powerful tool for generating code at compile time. It is specifically designed for Kotlin and provides better performance and integration with Kotlin features compared to traditional annotation processors.<br />
Room uses KSP to generate the necessary code for database operations based on the annotations you provide in your Entity and DAO classes.</p>
</div>
<p><a href="https://developer.android.com/training/data-storage/room">More about Room</a></p>
<h3 id="entity">Entity</h3>
<p>An <strong>Entity</strong> represents a table in the database. It is defined using a Kotlin data class annotated with <code>@Entity</code>. Each property of the data class corresponds to a column in the table.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">androidx.room.Entity</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.room.PrimaryKey</span>

<span class="nd">@Entity</span><span class="p">(</span><span class="n">tableName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;users&quot;</span><span class="p">)</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@PrimaryKey</span><span class="p">(</span><span class="n">autoGenerate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">id</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">age</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span>
<span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>Another annotations that we can use in an Entity are:</p>
<ul>
<li><code>@ColumnInfo</code>: Specifies the column name in the database.</li>
<li><code>@Ignore</code>: Excludes a property from being persisted in the database.</li>
<li><code>@Embedded</code>: Allows embedding another data class as a column in the entity (used for relationships between entities).</li>
<li><code>@ForeignKey</code>: Defines a foreign key relationship between two entities.</li>
<li><code>@Index</code>: Creates an index on one or more columns to improve query performance.</li>
<li><code>@TypeConverters</code>: Specifies custom type converters for complex data types.</li>
<li><code>@Relation</code>: Defines a relationship between two entities (used in conjunction with <code>@Embedded</code>).</li>
</ul>
<p>Example:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@Entity</span><span class="p">(</span><span class="n">tableName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;orders&quot;</span><span class="p">)</span>
<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Order</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@PrimaryKey</span><span class="p">(</span><span class="n">autoGenerate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">orderId</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@ForeignKey</span><span class="p">(</span>
<span class="w">        </span><span class="n">entity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">User</span><span class="o">::</span><span class="n">class</span><span class="p">,</span>
<span class="w">        </span><span class="n">parentColumns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s">&quot;id&quot;</span><span class="o">]</span><span class="p">,</span>
<span class="w">        </span><span class="n">childColumns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s">&quot;userId&quot;</span><span class="o">]</span><span class="p">,</span>
<span class="w">        </span><span class="n">onDelete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ForeignKey</span><span class="p">.</span><span class="na">CASCADE</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">userId</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@ColumnInfo</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;product_name&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">product</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
<span class="w">    </span><span class="nd">@ColumnInfo</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;quantity_ordered&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">quantity</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span>
<span class="w">    </span><span class="nd">@Ignore</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">tempData</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="c1">// This property will not be persisted in the database</span>
<span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><a href="https://developer.android.com/training/data-storage/room/defining-data">More about Entities</a></p>
<h3 id="dao-data-access-object">DAO (Data Access Object)</h3>
<p>A <strong>DAO</strong> is an interface that defines the methods for accessing the database. It is annotated with <code>@Dao</code> and contains methods for performing <strong>CRUD</strong> (Create, Read, Update, Delete) operations on the entities.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">androidx.room.Dao</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.room.Insert</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.room.Query</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.room.Update</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.room.Delete</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.Flow</span>

<span class="nd">@Dao</span>
<span class="kd">interface</span><span class="w"> </span><span class="nc">UserDao</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Insert</span><span class="p">(</span><span class="n">onConflict</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OnConflictStrategy</span><span class="p">.</span><span class="na">IGNORE</span><span class="p">)</span>
<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">insertUser</span><span class="p">(</span><span class="n">user</span><span class="p">:</span><span class="w"> </span><span class="n">User</span><span class="p">):</span><span class="w"> </span><span class="kt">Long</span><span class="w"> </span><span class="c1">//Returns the new rowId</span>

<span class="w">    </span><span class="nd">@Query</span><span class="p">(</span><span class="s">&quot;SELECT * FROM users&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getAllUsers</span><span class="p">():</span><span class="w"> </span><span class="n">Flow</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;&gt;</span>

<span class="w">    </span><span class="nd">@Query</span><span class="p">(</span><span class="s">&quot;SELECT * FROM users WHERE id = :userId&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getUserById</span><span class="p">(</span><span class="n">userId</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">):</span><span class="w"> </span><span class="n">User?</span>

<span class="w">    </span><span class="nd">@Update</span>
<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">updateUser</span><span class="p">(</span><span class="n">user</span><span class="p">:</span><span class="w"> </span><span class="n">User</span><span class="p">)</span>

<span class="w">    </span><span class="nd">@Delete</span>
<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">deleteUser</span><span class="p">(</span><span class="n">user</span><span class="p">:</span><span class="w"> </span><span class="n">User</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>The <code>@Insert</code> operation can produce a <strong>conflict</strong>. A conflict occurs when you try to insert a new row that has the same primary key or unique constraint as an existing row in the table.</p>
<p>There are  different conflict strategies:</p>
<ul>
<li><code>OnConflictStrategy.REPLACE</code>: Replaces the existing row with the new data.</li>
<li><code>OnConflictStrategy.IGNORE</code>: Ignores the new data if a conflict occurs.</li>
<li><code>OnConflictStrategy.ABORT</code>: Aborts the transaction if a conflict occurs (default behavior).</li>
<li><code>OnConflictStrategy.FAIL</code>: Fails the transaction if a conflict occurs.</li>
<li><code>OnConflictStrategy.ROLLBACK</code>: Rolls back the transaction if a conflict occurs.</li>
</ul>
<p>If the <code>@Insert</code> method receives a single parameter, it can return a long value, which is the new rowId for the inserted item.</p>
<p>The <code>@Update</code> and <code>@Delete</code> methods can optionally return an integer value representing the number of rows affected by the operation.</p>
<p>In the <code>@Query</code> method, you can pass parameters using the <code>:</code> syntax:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@Query</span><span class="p">(</span><span class="s">&quot;SELECT * FROM users WHERE id = :userId&quot;</span><span class="p">)</span>
<span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getUserById</span><span class="p">(</span><span class="n">userId</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">):</span><span class="w"> </span><span class="n">User?</span>

<span class="nd">@Query</span><span class="p">(</span><span class="s">&quot;SELECT * FROM user WHERE age BETWEEN :minAge AND :maxAge&quot;</span><span class="p">)</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">loadAllUsersBetweenAges</span><span class="p">(</span><span class="n">minAge</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">maxAge</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">):</span><span class="w"> </span><span class="n">Array</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span>

<span class="nd">@Query</span><span class="p">(</span><span class="s">&quot;SELECT * FROM user WHERE first_name LIKE :search &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;OR last_name LIKE :search&quot;</span><span class="p">)</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">findUserWithName</span><span class="p">(</span><span class="n">search</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">):</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<div class="admonition tip">
<p class="admonition-title">When do not use suspend functions in DAO methods</p>
<p>You should not use <code>suspend</code> functions in DAO methods that return <code>LiveData</code> or <code>Flow</code>. These return types are designed to be observed and will automatically handle threading for you. Using <code>suspend</code> with these return types can lead to unexpected behavior and is not necessary.</p>
</div>
<div class="admonition info">
<p class="admonition-title">Flow vs. LiveData in Room DAOs</p>
<p>Both <code>Flow</code> and <code>LiveData</code> are observable data holders that can be used to observe changes in the database. However, there are some differences between them:</p>
<ul>
<li>
<p><strong>Flow</strong> is a Kotlin coroutine-based API that provides a more flexible and powerful way to handle asynchronous data streams. It supports operators for transforming and combining data streams, making it suitable for complex data processing scenarios.</p>
</li>
<li>
<p><strong>LiveData</strong> is a lifecycle-aware component that is part of the Android Architecture Components. It is designed to work seamlessly with the Android lifecycle, automatically managing subscriptions based on the lifecycle state of the observing components (e.g., Activities or Fragments).</p>
</li>
</ul>
<p>In general, if you are using Kotlin coroutines and need more advanced data processing capabilities, <code>Flow</code> is a better choice. If you are working within the Android lifecycle and want a simpler way to observe data changes, <code>LiveData</code> may be more appropriate.</p>
</div>
<p><a href="https://developer.android.com/training/data-storage/room/accessing-data">More about DAOs</a></p>
<h3 id="database">Database</h3>
<p>The database class is an abstract class that extends <code>RoomDatabase</code>. It is annotated with <code>@Database</code> and defines the entities and DAOs for the database.</p>
<p>A <strong>singleton pattern</strong> is typically used to ensure that only one instance of the database is created throughout the app's lifecycle.</p>
<p>An implementation example is shown below:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">androidx.room.Database</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.room.Room</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.room.RoomDatabase</span>
<span class="k">import</span><span class="w"> </span><span class="nn">android.content.Context</span>

<span class="nd">@Database</span><span class="p">(</span><span class="n">entities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">User</span><span class="o">::</span><span class="n">class</span><span class="p">,</span><span class="w"> </span><span class="n">Order</span><span class="o">::</span><span class="n">class</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
<span class="kd">abstract</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">AppDatabase</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">RoomDatabase</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">abstract</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">userDao</span><span class="p">():</span><span class="w"> </span><span class="n">UserDao</span>
<span class="w">    </span><span class="kd">abstract</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">orderDao</span><span class="p">():</span><span class="w"> </span><span class="n">OrderDao</span>

<span class="w">    </span><span class="kd">companion</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="nd">@Volatile</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">INSTANCE</span><span class="p">:</span><span class="w"> </span><span class="n">AppDatabase? </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>

<span class="w">        </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getDatabase</span><span class="p">(</span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="n">Context</span><span class="p">):</span><span class="w"> </span><span class="n">AppDatabase</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">INSTANCE</span><span class="w"> </span><span class="o">?:</span><span class="w"> </span><span class="n">synchronized</span><span class="p">(</span><span class="k">this</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Room</span><span class="p">.</span><span class="na">databaseBuilder</span><span class="p">(</span>
<span class="w">                    </span><span class="n">context</span><span class="p">.</span><span class="na">applicationContext</span><span class="p">,</span>
<span class="w">                    </span><span class="n">AppDatabase</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;app_database&quot;</span>
<span class="w">                </span><span class="p">).</span><span class="na">build</span><span class="p">()</span>
<span class="w">                </span><span class="n">INSTANCE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instance</span>
<span class="w">                </span><span class="n">instance</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>The <strong>version number</strong> on the Database annotation should be incremented whenever the database schema is changed. For example, if a new entity is added or an existing entity is modified, the version number should be increased to ensure that the database is properly migrated to the new schema.</p>
<p>The <code>synchronized</code> block ensures that only one thread can access the database instance creation code at a time, preventing multiple instances from being created in a multi-threaded environment.</p>
<h2 id="repository">Repository</h2>
<p>The <strong>Repository</strong> acts as a mediator between the data sources (Room database, network, etc.) and the rest of the application. It provides a clean API for data access and abstracts the underlying data sources.</p>
<p>Although not strictly part of Room, the Repository pattern is commonly used in conjunction with Room.</p>
<p><img alt="Repository Pattern" src="../images/room_app.webp" /></p>
<p>It is usual to create a Repository class for each Entity/DAO pair. An example of a UserRepository is shown below:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nc">UserRepository</span><span class="p">(</span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">userDao</span><span class="p">:</span><span class="w"> </span><span class="n">UserDao</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">allUsers</span><span class="p">:</span><span class="w"> </span><span class="n">Flow</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userDao</span><span class="p">.</span><span class="na">getAllUsers</span><span class="p">()</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="n">user</span><span class="p">:</span><span class="w"> </span><span class="n">User</span><span class="p">):</span><span class="w"> </span><span class="kt">Long</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">userDao</span><span class="p">.</span><span class="na">insertUser</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getUserById</span><span class="p">(</span><span class="n">userId</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">):</span><span class="w"> </span><span class="n">User? </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">userDao</span><span class="p">.</span><span class="na">getUserById</span><span class="p">(</span><span class="n">userId</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="n">user</span><span class="p">:</span><span class="w"> </span><span class="n">User</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">userDao</span><span class="p">.</span><span class="na">updateUser</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">suspend</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="n">user</span><span class="p">:</span><span class="w"> </span><span class="n">User</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">userDao</span><span class="p">.</span><span class="na">deleteUser</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="using-the-data-in-the-ui-layer">Using the data in the UI layer</h2>
<p>In the UI layer, you can use ViewModels to interact with the Repository and observe data changes.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.ViewModel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.lifecycle.viewModelScope</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.collect</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.launch</span>

<span class="kd">class</span><span class="w"> </span><span class="nc">UserViewModel</span><span class="p">(</span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">userRepository</span><span class="p">:</span><span class="w"> </span><span class="n">UserRepository</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ViewModel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">allUsers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userRepository</span><span class="p">.</span><span class="na">allUsers</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">insertUser</span><span class="p">(</span><span class="n">user</span><span class="p">:</span><span class="w"> </span><span class="n">User</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">viewModelScope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">userRepository</span><span class="p">.</span><span class="na">insert</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">getUserById</span><span class="p">(</span><span class="n">userId</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">viewModelScope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">userRepository</span><span class="p">.</span><span class="na">getUserById</span><span class="p">(</span><span class="n">userId</span><span class="p">)</span><span class="o">?.</span><span class="na">let</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="c1">// Update UI with user data</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">updateUser</span><span class="p">(</span><span class="n">user</span><span class="p">:</span><span class="w"> </span><span class="n">User</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">viewModelScope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">userRepository</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">deleteUser</span><span class="p">(</span><span class="n">user</span><span class="p">:</span><span class="w"> </span><span class="n">User</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">viewModelScope</span><span class="p">.</span><span class="na">launch</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">userRepository</span><span class="p">.</span><span class="na">delete</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.expand", "content.code.copy"], "search": "../../assets/javascripts/workers/search.a264c092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.4e0fa4ba.min.js"></script>
      
    
  </body>
</html>